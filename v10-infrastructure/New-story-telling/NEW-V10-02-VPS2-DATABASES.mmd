%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#E3F2FD','primaryTextColor':'#1565C0','primaryBorderColor':'#1976D2','lineColor':'#42A5F5','secondaryColor':'#F3E5F5','tertiaryColor':'#E8F5E9'}}}%%

%% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
%% TRM AI PRODUCTION SYSTEM V10 - VPS2 DATABASES & LAKEHOUSE
%% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
%% Philosophy: "AI CÃ“ MÃY TÃNH RIÃŠNG" - Data sovereignty, 100% ownership
%% Link: See NEW-V10-00-MASTER-OVERVIEW.mmd for full context
%% Date: 2025-01-05
%% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

graph TB
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    %% LAYER 1: PRODUCT AI DATABASES (12GB)
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    subgraph VPS2["ğŸ—„ï¸ VPS2: ALL DATABASES (24GB)"]
        subgraph PRODUCT_DBS["Product AI Databases - 12GB"]
            NEO4J_PROD_GRAPH["ğŸ•¸ï¸ Neo4j Product Graph<br/>6GB | 22M nodes<br/>âš¡ Knowledge graph"]
            NEO4J_PROD_CACHE["ğŸ’¾ Neo4j Product Cache<br/>3GB | 10M nodes<br/>âš¡ Query cache"]
            LANCE_PROD["ğŸ” LanceDB Product<br/>500MB | 15M vectors<br/>âš¡ 8x less RAM than Qdrant!"]
            POSTGRES_PROD["ğŸ˜ PostgreSQL Product<br/>1.5GB | Structured data"]
            REDIS_PROD["âš¡ Redis Product<br/>500MB | Session cache"]
            NOCODB["ğŸ“Š NocoDB<br/>500MB | No-code database UI"]
        end
        
        subgraph AGENT_DBS["Agent AI Databases - 4.8GB"]
            NEO4J_AGENT["ğŸ•¸ï¸ Neo4j Agent<br/>2GB | Infrastructure graph"]
            LANCE_AGENT["ğŸ” LanceDB Agent<br/>300MB | 5M vectors<br/>âš¡ 6.7x less RAM!"]
            POSTGRES_AGENT["ğŸ˜ PostgreSQL Agent<br/>1.5GB | Logs & metrics"]
            REDIS_AGENT["âš¡ Redis Agent<br/>1GB | Task queue"]
        end
        
        subgraph LAKEHOUSE["Data Lakehouse - 2.2GB"]
            DUCKDB["ğŸ¦† DuckDB<br/>500MB | OLAP analytics<br/>âš¡ 100x faster than Postgres"]
            AIRBYTE["ğŸ”„ Airbyte<br/>500MB | Data pipelines<br/>âš¡ 300+ connectors"]
            DBT["ğŸ› ï¸ dbt<br/>200MB | Transform data<br/>âš¡ SQL-based"]
            UNSTRUCTURED["ğŸ“„ Unstructured.io<br/>500MB | Document ETL<br/>âš¡ PDF/Word extraction"]
            ICEBERG["ğŸ§Š Apache Iceberg<br/>500MB | Table format<br/>âš¡ Time travel"]
        end
    end
    
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    %% LAYER 2: DATA FLOWS
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    %% Product AI Data Flow
    NEO4J_PROD_GRAPH -->|"Cache queries"| NEO4J_PROD_CACHE
    LANCE_PROD -->|"Vector search"| NEO4J_PROD_GRAPH
    POSTGRES_PROD -->|"Structured data"| NEO4J_PROD_GRAPH
    REDIS_PROD -->|"Session cache"| POSTGRES_PROD
    NOCODB -->|"UI access"| POSTGRES_PROD
    
    %% Agent AI Data Flow
    NEO4J_AGENT -->|"Infrastructure state"| POSTGRES_AGENT
    LANCE_AGENT -->|"Semantic search"| NEO4J_AGENT
    REDIS_AGENT -->|"Task queue"| POSTGRES_AGENT
    
    %% Lakehouse Flow
    AIRBYTE -->|"Extract data"| UNSTRUCTURED
    UNSTRUCTURED -->|"Transform"| DBT
    DBT -->|"Load to"| DUCKDB
    DUCKDB -->|"Store in"| ICEBERG
    ICEBERG -->|"Query from"| NEO4J_PROD_GRAPH
    
    %% Cross-System Sync
    NEO4J_PROD_GRAPH -.->|"Sync insights"| NEO4J_AGENT
    DUCKDB -.->|"Analytics"| POSTGRES_PROD
    
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    %% LAYER 3: KEY BENEFITS
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    BENEFITS["ğŸ’° BENEFITS:<br/>âœ… LanceDB: 5.2GB RAM saved vs Qdrant<br/>âœ… DuckDB: 100x faster analytics<br/>âœ… 100% data ownership<br/>âœ… No vendor lock-in<br/>âœ… Unlimited storage"]
    
    VPS2 -.->|"Delivers"| BENEFITS
    
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    %% STYLING
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    classDef graphStyle fill:#E3F2FD,stroke:#1976D2,stroke-width:3px,color:#0D47A1
    classDef vectorStyle fill:#F3E5F5,stroke:#7B1FA2,stroke-width:3px,color:#4A148C
    classDef sqlStyle fill:#E8F5E9,stroke:#388E3C,stroke-width:3px,color:#1B5E20
    classDef cacheStyle fill:#FFF3E0,stroke:#F57C00,stroke-width:3px,color:#E65100
    classDef lakehouseStyle fill:#E0F2F1,stroke:#00796B,stroke-width:3px,color:#004D40
    classDef benefitStyle fill:#FCE4EC,stroke:#C2185B,stroke-width:3px,color:#880E4F
    
    class NEO4J_PROD_GRAPH,NEO4J_PROD_CACHE,NEO4J_AGENT graphStyle
    class LANCE_PROD,LANCE_AGENT vectorStyle
    class POSTGRES_PROD,POSTGRES_AGENT,NOCODB sqlStyle
    class REDIS_PROD,REDIS_AGENT cacheStyle
    class DUCKDB,AIRBYTE,DBT,UNSTRUCTURED,ICEBERG lakehouseStyle
    class BENEFITS benefitStyle
