%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#E3F2FD','primaryTextColor':'#1565C0','primaryBorderColor':'#1976D2','lineColor':'#42A5F5','secondaryColor':'#F3E5F5','tertiaryColor':'#E8F5E9'}}}%%

%% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
%% TRM AI PRODUCTION SYSTEM V10 - MONITORING & OBSERVABILITY
%% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
%% Philosophy: "AI CÃ“ MÃY TÃNH RIÃŠNG" - AI monitors itself, 90% self-healing
%% Link: See NEW-V10-00-MASTER-OVERVIEW.mmd for full context
%% Date: 2025-01-05
%% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

graph TB
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    %% LAYER 1: DATA SOURCES (4 VPS)
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    subgraph SOURCES["ğŸ“Š MONITORING SOURCES"]
        VPS1["ğŸ¢ VPS1<br/>Infrastructure metrics"]
        VPS2["ğŸ—„ï¸ VPS2<br/>Database metrics"]
        VPS3["ğŸ¤– VPS3<br/>AI metrics"]
        VPS4["âš¡ VPS4<br/>Code execution metrics"]
    end
    
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    %% LAYER 2: COLLECTION LAYER
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    subgraph COLLECTION["ğŸ“¥ DATA COLLECTION"]
        PROMETHEUS["ğŸ“ˆ Prometheus<br/>3GB RAM<br/>âš¡ Metrics collection<br/>âš¡ 15s scrape interval"]
        LOKI["ğŸ“ Loki<br/>1.5GB RAM<br/>âš¡ Log aggregation<br/>âš¡ Label-based indexing"]
        TEMPO["â±ï¸ Tempo<br/>500MB RAM<br/>âš¡ Distributed tracing<br/>âš¡ OpenTelemetry"]
        SENTRY["ğŸ› Sentry<br/>1GB RAM<br/>âš¡ Error tracking<br/>âš¡ Performance monitoring"]
    end
    
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    %% LAYER 3: VISUALIZATION & ALERTING
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    subgraph VISUALIZATION["ğŸ“Š VISUALIZATION"]
        GRAFANA["ğŸ“Š Grafana<br/>2GB RAM<br/>âš¡ Unified dashboards<br/>âš¡ Real-time updates"]
        REFLEX["ğŸ¨ Reflex Dashboard<br/>800MB RAM<br/>âš¡ AI-generated UI<br/>âš¡ Python-based"]
    end
    
    subgraph ALERTING["ğŸš¨ ALERTING"]
        ALERTA["ğŸ“¢ Alerta<br/>500MB RAM<br/>âš¡ Alert aggregation<br/>âš¡ De-duplication"]
        UPTIME["ğŸ“Š Uptime Kuma<br/>500MB RAM<br/>âš¡ Status page<br/>âš¡ Health checks"]
    end
    
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    %% LAYER 4: AI AGENTS (Self-Healing)
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    subgraph AI_AGENTS["ğŸ¤– AI AGENTS (90% Self-Healing)"]
        MONITOR_AGENT["ğŸ‘ï¸ Monitor Agent<br/>âš¡ Watches all metrics"]
        INCIDENT_AGENT["ğŸš¨ Incident Agent<br/>âš¡ Auto-responds to alerts"]
        COST_AGENT["ğŸ’° Cost Agent<br/>âš¡ Optimizes resources"]
    end
    
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    %% LAYER 5: DATA FLOWS
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    %% Sources â†’ Collection
    VPS1 -->|"Metrics"| PROMETHEUS
    VPS2 -->|"Metrics"| PROMETHEUS
    VPS3 -->|"Metrics"| PROMETHEUS
    VPS4 -->|"Metrics"| PROMETHEUS
    
    VPS1 -->|"Logs"| LOKI
    VPS2 -->|"Logs"| LOKI
    VPS3 -->|"Logs"| LOKI
    VPS4 -->|"Logs"| LOKI
    
    VPS3 -->|"Traces"| TEMPO
    VPS4 -->|"Traces"| TEMPO
    
    VPS3 -->|"Errors"| SENTRY
    VPS4 -->|"Errors"| SENTRY
    
    %% Collection â†’ Visualization
    PROMETHEUS -->|"Query"| GRAFANA
    LOKI -->|"Query"| GRAFANA
    TEMPO -->|"Query"| GRAFANA
    SENTRY -->|"Query"| GRAFANA
    
    PROMETHEUS -->|"Real-time"| REFLEX
    
    %% Collection â†’ Alerting
    PROMETHEUS -->|"Alert rules"| ALERTA
    LOKI -->|"Log alerts"| ALERTA
    SENTRY -->|"Error alerts"| ALERTA
    
    UPTIME -->|"Health status"| ALERTA
    
    %% Alerting â†’ AI Agents
    ALERTA -->|"Incidents"| INCIDENT_AGENT
    GRAFANA -->|"Metrics"| MONITOR_AGENT
    PROMETHEUS -->|"Cost data"| COST_AGENT
    
    %% AI Agents â†’ Actions
    INCIDENT_AGENT -.->|"Auto-fix"| VPS1
    MONITOR_AGENT -.->|"Optimize"| VPS2
    COST_AGENT -.->|"Scale down"| VPS3
    
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    %% LAYER 6: BENEFITS
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    BENEFITS["ğŸ¯ MONITORING BENEFITS:<br/>âœ… 90% self-healing (AI fixes issues)<br/>âœ… <1min incident response<br/>âœ… Unified observability (metrics+logs+traces)<br/>âœ… Real-time dashboards<br/>âœ… Cost optimization (auto-scale)<br/>âœ… Zero manual intervention"]
    
    AI_AGENTS -.->|"Delivers"| BENEFITS
    
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    %% STYLING
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    classDef sourceStyle fill:#E3F2FD,stroke:#1976D2,stroke-width:3px,color:#0D47A1
    classDef collectionStyle fill:#F3E5F5,stroke:#7B1FA2,stroke-width:3px,color:#4A148C
    classDef vizStyle fill:#E8F5E9,stroke:#388E3C,stroke-width:3px,color:#1B5E20
    classDef alertStyle fill:#FFEBEE,stroke:#C62828,stroke-width:3px,color:#B71C1C
    classDef aiStyle fill:#FFF3E0,stroke:#F57C00,stroke-width:3px,color:#E65100
    classDef benefitStyle fill:#FCE4EC,stroke:#C2185B,stroke-width:3px,color:#880E4F
    
    class VPS1,VPS2,VPS3,VPS4 sourceStyle
    class PROMETHEUS,LOKI,TEMPO,SENTRY collectionStyle
    class GRAFANA,REFLEX vizStyle
    class ALERTA,UPTIME alertStyle
    class MONITOR_AGENT,INCIDENT_AGENT,COST_AGENT aiStyle
    class BENEFITS benefitStyle
