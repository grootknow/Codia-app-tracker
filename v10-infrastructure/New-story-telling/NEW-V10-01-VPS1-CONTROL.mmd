%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#E3F2FD','primaryTextColor':'#1565C0','primaryBorderColor':'#1976D2','lineColor':'#42A5F5','secondaryColor':'#F3E5F5','tertiaryColor':'#E8F5E9'}}}%%

%% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
%% TRM AI PRODUCTION SYSTEM V10 - VPS1 CONTROL & MONITORING
%% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
%% Philosophy: "AI CÃ“ MÃY TÃNH RIÃŠNG" - AI cáº§m 95% infrastructure
%% Link: See NEW-V10-00-MASTER-OVERVIEW.mmd for full context
%% Date: 2025-01-05
%% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

graph TB
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    %% LAYER 1: INFRASTRUCTURE CONTROL (AI cáº§m 95%)
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    subgraph VPS1["ğŸ¢ VPS1: CONTROL & MONITORING (24GB)"]
        subgraph INFRA["Infrastructure Control - 5.8GB"]
            COOLIFY["ğŸ³ Coolify<br/>2GB | AI auto-deploy"]
            TRAEFIK["ğŸŒ Traefik<br/>500MB | Reverse proxy"]
            CLOUDFLARE["â˜ï¸ Cloudflare Tunnel<br/>100MB | Zero Trust"]
            KOPIA["ğŸ’¾ Kopia<br/>500MB | Deduplicated backup"]
            KAMAL["ğŸš€ Kamal<br/>200MB | Infrastructure as Code<br/>âš¡ 10x faster recovery"]
        end
        
        subgraph OBSERVABILITY["Observability Stack - 8GB"]
            GRAFANA["ğŸ“Š Grafana<br/>2GB | Dashboards"]
            PROMETHEUS["ğŸ“ˆ Prometheus<br/>3GB | Metrics"]
            LOKI["ğŸ“ Loki<br/>1.5GB | Logs"]
            SENTRY["ğŸ› Sentry<br/>1GB | Error tracking"]
            TEMPO["â±ï¸ Tempo<br/>500MB | Traces"]
            ALERTA["ğŸ“¢ Alerta<br/>500MB | Alerts"]
        end
        
        subgraph AUTOMATION["Automation - 800MB"]
            WINDMILL["âš¡ Windmill<br/>800MB | Code-first workflows<br/>ğŸ¯ AI writes Python/TS"]
        end
        
        subgraph REALTIME["Real-Time Sync - 1.3GB"]
            SUPABASE["ğŸ”„ Supabase Realtime<br/>500MB | WebSocket hub<br/>âš¡ <200ms sync"]
            REFLEX["ğŸ“Š Reflex Dashboard<br/>800MB | Python UI<br/>ğŸ¯ AI-generated dashboards"]
        end
        
        subgraph DEVOPS["DevOps Tools - 2.4GB"]
            GITEA["ğŸ¦Š Gitea<br/>800MB | Git + CI/CD"]
            TRIVY["ğŸ›¡ï¸ Trivy<br/>300MB | Security scan"]
            INFISICAL["ğŸ” Infisical<br/>500MB | Secrets for machines"]
            FALCO["ğŸ‘ï¸ Falco<br/>300MB | Runtime security"]
            UPTIME["ğŸ“Š Uptime Kuma<br/>500MB | Status page"]
        end
        
        subgraph MCP_GATEWAY["MCP Gateway - 1GB"]
            CF_CORE["ğŸ”Œ ContextForge Core<br/>1GB | 145+ MCP tools<br/>âš¡ AI's toolbox"]
        end
    end
    
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    %% LAYER 2: CONNECTIONS
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    %% Infrastructure Control Flow
    COOLIFY -->|"Auto-deploy"| TRAEFIK
    TRAEFIK -->|"Route traffic"| CLOUDFLARE
    KOPIA -->|"Backup to R2"| CLOUDFLARE
    KAMAL -->|"IaC deploy"| COOLIFY
    
    %% Observability Flow
    PROMETHEUS -->|"Metrics"| GRAFANA
    LOKI -->|"Logs"| GRAFANA
    TEMPO -->|"Traces"| GRAFANA
    SENTRY -->|"Errors"| GRAFANA
    ALERTA -->|"Alerts"| GRAFANA
    
    %% Automation Flow
    WINDMILL -->|"Execute workflows"| COOLIFY
    WINDMILL -->|"Query metrics"| PROMETHEUS
    
    %% Real-Time Flow
    SUPABASE -->|"Push updates"| REFLEX
    REFLEX -->|"Display dashboards"| GRAFANA
    
    %% DevOps Flow
    GITEA -->|"Trigger CI/CD"| TRIVY
    TRIVY -->|"Scan images"| COOLIFY
    INFISICAL -->|"Inject secrets"| COOLIFY
    FALCO -->|"Security events"| ALERTA
    UPTIME -->|"Health checks"| GRAFANA
    
    %% MCP Gateway
    CF_CORE -->|"Tool calls"| COOLIFY
    CF_CORE -->|"Tool calls"| WINDMILL
    CF_CORE -->|"Tool calls"| GITEA
    
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    %% STYLING
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    classDef infraStyle fill:#E3F2FD,stroke:#1976D2,stroke-width:3px,color:#0D47A1
    classDef monitorStyle fill:#F3E5F5,stroke:#7B1FA2,stroke-width:3px,color:#4A148C
    classDef autoStyle fill:#E8F5E9,stroke:#388E3C,stroke-width:3px,color:#1B5E20
    classDef realtimeStyle fill:#FFF3E0,stroke:#F57C00,stroke-width:3px,color:#E65100
    classDef devopsStyle fill:#E0F2F1,stroke:#00796B,stroke-width:3px,color:#004D40
    classDef mcpStyle fill:#FCE4EC,stroke:#C2185B,stroke-width:3px,color:#880E4F
    
    class COOLIFY,TRAEFIK,CLOUDFLARE,KOPIA,KAMAL infraStyle
    class GRAFANA,PROMETHEUS,LOKI,SENTRY,TEMPO,ALERTA monitorStyle
    class WINDMILL autoStyle
    class SUPABASE,REFLEX realtimeStyle
    class GITEA,TRIVY,INFISICAL,FALCO,UPTIME devopsStyle
    class CF_CORE mcpStyle
