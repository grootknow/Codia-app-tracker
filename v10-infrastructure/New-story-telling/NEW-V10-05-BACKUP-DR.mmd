%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#E3F2FD','primaryTextColor':'#1565C0','primaryBorderColor':'#1976D2','lineColor':'#42A5F5','secondaryColor':'#F3E5F5','tertiaryColor':'#E8F5E9'}}}%%

%% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
%% TRM AI PRODUCTION SYSTEM V10 - BACKUP & DISASTER RECOVERY
%% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
%% Philosophy: "AI CÃ“ MÃY TÃNH RIÃŠNG" - 4-tier backup, 10x faster recovery
%% Link: See NEW-V10-00-MASTER-OVERVIEW.mmd for full context
%% Date: 2025-01-05
%% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

graph TB
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    %% LAYER 1: SOURCE DATA
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    subgraph SOURCES["ğŸ“¦ DATA SOURCES"]
        VPS1_DATA["ğŸ¢ VPS1 Data<br/>Configs, logs, metrics"]
        VPS2_DATA["ğŸ—„ï¸ VPS2 Data<br/>All databases (20GB)"]
        VPS3_DATA["ğŸ¤– VPS3 Data<br/>AI models, skills"]
        VPS4_DATA["âš¡ VPS4 Data<br/>Code execution state"]
    end
    
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    %% LAYER 2: BACKUP TOOL
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    subgraph BACKUP_ENGINE["ğŸ’¾ BACKUP ENGINE"]
        KOPIA["ğŸ”§ Kopia<br/>500MB RAM<br/>âš¡ Deduplicated backups<br/>âš¡ Encrypted<br/>âš¡ Incremental"]
        KAMAL["ğŸš€ Kamal<br/>200MB RAM<br/>âš¡ Infrastructure as Code<br/>âš¡ Auto-deploy<br/>âš¡ 10x faster recovery"]
    end
    
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    %% LAYER 3: 4-TIER BACKUP STRATEGY
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    subgraph TIER1["ğŸ”¥ TIER 1: HOT BACKUP (Real-time)"]
        R2["â˜ï¸ Cloudflare R2<br/>$0.015/GB/mo<br/>âš¡ <1s access<br/>âš¡ Unlimited egress<br/>ğŸ“Š Total: ~$3/mo"]
    end
    
    subgraph TIER2["âš¡ TIER 2: WARM BACKUP (Daily)"]
        GDRIVE["ğŸ“ Google Drive<br/>$10/mo for 2TB<br/>âš¡ 5s access<br/>âš¡ Versioning"]
    end
    
    subgraph TIER3["â„ï¸ TIER 3: COLD BACKUP (Weekly)"]
        GLACIER["ğŸ§Š AWS Glacier<br/>$0.004/GB/mo<br/>âš¡ 12h retrieval<br/>ğŸ“Š Total: ~$1/mo"]
    end
    
    subgraph TIER4["ğŸ” TIER 4: DISASTER RECOVERY (Monthly)"]
        GITHUB["ğŸ¦Š GitHub<br/>Free for code<br/>âš¡ Infrastructure as Code<br/>âš¡ Kamal configs"]
    end
    
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    %% LAYER 4: DATA FLOWS
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    %% Source â†’ Kopia
    VPS1_DATA -->|"Continuous"| KOPIA
    VPS2_DATA -->|"Continuous"| KOPIA
    VPS3_DATA -->|"Continuous"| KOPIA
    VPS4_DATA -->|"Continuous"| KOPIA
    
    %% Kopia â†’ 4 Tiers
    KOPIA -->|"Real-time<br/>Every 15min"| R2
    KOPIA -->|"Daily<br/>3AM UTC"| GDRIVE
    KOPIA -->|"Weekly<br/>Sunday"| GLACIER
    
    %% Kamal â†’ GitHub
    KAMAL -->|"Infrastructure as Code<br/>Every commit"| GITHUB
    
    %% Recovery Flows
    R2 -.->|"Restore<br/><1min"| VPS1_DATA
    GDRIVE -.->|"Restore<br/><5min"| VPS2_DATA
    GLACIER -.->|"Restore<br/><12h"| VPS3_DATA
    GITHUB -.->|"Redeploy<br/><45min"| KAMAL
    
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    %% LAYER 5: BENEFITS
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    BENEFITS["ğŸ¯ RECOVERY TIMES:<br/>âœ… Tier 1 (R2): <1 minute<br/>âœ… Tier 2 (GDrive): <5 minutes<br/>âœ… Tier 3 (Glacier): <12 hours<br/>âœ… Tier 4 (Kamal): <45 minutes<br/><br/>ğŸ’° TOTAL COST: $14/mo<br/>âš¡ 10x faster than manual (4-5h â†’ 45min)"]
    
    TIER1 -.->|"Delivers"| BENEFITS
    TIER4 -.->|"Delivers"| BENEFITS
    
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    %% STYLING
    %% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    classDef sourceStyle fill:#E3F2FD,stroke:#1976D2,stroke-width:3px,color:#0D47A1
    classDef toolStyle fill:#F3E5F5,stroke:#7B1FA2,stroke-width:3px,color:#4A148C
    classDef hotStyle fill:#FFEBEE,stroke:#C62828,stroke-width:3px,color:#B71C1C
    classDef warmStyle fill:#FFF3E0,stroke:#F57C00,stroke-width:3px,color:#E65100
    classDef coldStyle fill:#E0F2F1,stroke:#00796B,stroke-width:3px,color:#004D40
    classDef drStyle fill:#E8F5E9,stroke:#388E3C,stroke-width:3px,color:#1B5E20
    classDef benefitStyle fill:#FCE4EC,stroke:#C2185B,stroke-width:3px,color:#880E4F
    
    class VPS1_DATA,VPS2_DATA,VPS3_DATA,VPS4_DATA sourceStyle
    class KOPIA,KAMAL toolStyle
    class R2 hotStyle
    class GDRIVE warmStyle
    class GLACIER coldStyle
    class GITHUB drStyle
    class BENEFITS benefitStyle
