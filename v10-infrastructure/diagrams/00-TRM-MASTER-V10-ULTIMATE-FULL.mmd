%%{init: {
  'theme': 'base',
  'themeVariables': {
    'primaryColor': '#E3F2FD',
    'primaryTextColor': '#1565C0',
    'primaryBorderColor': '#1976D2',
    'lineColor': '#424242',
    'secondaryColor': '#F3E5F5',
    'tertiaryColor': '#E8F5E9',
    'background': '#FFFFFF',
    'mainBkg': '#BBDEFB',
    'secondBkg': '#C5CAE9',
    'tertiaryBkg': '#C8E6C9',
    'clusterBkg': '#F5F5F5',
    'clusterBorder': '#9E9E9E',
    'titleColor': '#212121',
    'edgeLabelBackground': '#FFFFFF',
    'nodeTextColor': '#212121',
    'fontSize': '14px'
  }
}}%%

graph TB
    %% ============================================================================
    %% TRM AI PRODUCTION SYSTEM V10 ULTIMATE - PERFECT DESIGN & COMPLETE
    %% ============================================================================
    %% Version: 10.0 ULTIMATE + MCP GATEWAY (AI Control Infrastructure)
    %% Last Updated: 2025-11-04
    %% Architecture: 3-VPS Optimized (Control+Monitor | All Databases | Product+Agent AI)
    %% Infrastructure: 3-VPS Setup (24GB + 24GB + 12GB RAM)
    %% Total RAM: 60GB (optimized allocation)
    %% Monthly Cost: $155/mo (avg)
    %% Data Capacity: 22M triples + 10.4M vectors
    %% Models: Claude 4.5 + Grok 4 Fast + Gemini 2.0 (API calls)
    %% Deployment: 3 VPS (Contabo) + 8 AI Agents + Complete Observability
    %% MCP Gateway: ContextForge (IBM) - 145+ MCP tools - AI control 95% infrastructure
    %% 
    %% ğŸ¯ ULTIMATE DESIGN PRINCIPLES:
    %% - Perfect Visual Hierarchy: Clear layer separation
    %% - Zero Blind Spots: Every component connected
    %% - Optimal Layout: No scattered elements
    %% - Professional Styling: Color-coded by function
    %% 
    %% ğŸ¯ CORE INNOVATION V10:
    %% - 3-VPS Optimized: Smart resource allocation (Heavy DBs on VPS2, Light AI on VPS3)
    %% - Complete Observability: Sentry + Loki + Tempo + Prometheus + Alerta
    %% - 8 Autonomous AI Agents: DevOps, Data, Alert, Finance, Doc, Compliance, Test, Learning
    %% - Dual AI Systems: Product AI (user-facing) vs Agent AI (internal ops) - ISOLATED
    %% - MCP Gateway Layer: ContextForge (IBM) - AI control infrastructure via 145+ MCP tools
    %%   â€¢ Virtual MCPs: RESTâ†’MCP auto-conversion (Coolify, Gitea, Windmill, Grafana, Prometheus)
    %%   â€¢ Custom MCPs: FastMCP (Infrastructure, Database, Backup, Lakehouse)
    %%   â€¢ External MCPs: Apify, TwelveLabs, Perplexity, Replicate
    %%   â€¢ Features: Multi-tenant, RBAC, Federation, OpenTelemetry observability
    %% - Lakehouse Architecture: Bronze/Silver/Gold + DuckDB + Iceberg + CDC
    %% - Multi-Tier Backup: R2 + Google Drive + R2 Glacier + GitHub (4 tiers)
    %% - CI/CD Pipeline: Gitea Actions + Trivy + Auto-deploy
    %% - VPN Mesh: Headscale (secure internal network)
    %% - Alert Hub: Alerta (aggregate all alerts, auto-triage by AI)
    %% 
    %% ğŸš€ KEY DIFFERENTIATORS V10:
    %% - Purpose: AI-powered startup with 90% autonomous operations
    %% - Scale: 8 AI agents, 100+ skills, 15+ MCPs, 10 databases, 35+ apps
    %% - Cost-Optimized: 3-VPS + API calls ($155/month avg, +$15 from V9)
    %% - Autonomous: AI agents handle deploy, monitor, alert, backup, docs, compliance
    %% - Observability: Full stack (metrics, logs, errors, traces, alerts)
    %% - Security: Zero Trust + VPN Mesh + Security Scan + Compliance Guardian
    %% - Performance: <200ms realtime sync, <100ms CDC, 99.9% uptime
    %% - Data: 22M triples (Neo4j), 10.4M vectors (LanceDB), Lakehouse (R2)
    %% 
    %% Created: 03/11/2025 (V7) | V9: 04/11/2025 | V10: 04/11/2025
    %% ============================================================================

    %% ============================================================================
    %% ğŸ¯ CORE PHILOSOPHY: "AI CÃ“ MÃY TÃNH RIÃŠNG"
    %% ============================================================================
    %% 
    %% KHÃ”NG PHáº¢I: ThuÃª AI (ChatGPT, Claude.ai) Ä‘á»ƒ lÃ m task
    %% MÃ€ LÃ€: Sá» Há»®U INFRASTRUCTURE + DATA + KNOWLEDGE + PLATFORM
    %% 
    %% Sá»Ÿ há»¯u:
    %%   âœ… Infrastructure: 3 VPS (60GB RAM), databases, storage
    %%   âœ… Data: 22M triples (Neo4j), 10.4M vectors (LanceDB)
    %%   âœ… Knowledge: Knowledge graph compounds forever
    %%   âœ… Skills: 100+ workflows documented, shareable
    %%   âœ… Platform: Foundation for future products
    %% 
    %% Káº¿t quáº£:
    %%   âœ… Replace 13 workers: $76,000/mo â†’ $155/mo (490x ROI)
    %%   âœ… Data ownership: 100% (your servers, your data)
    %%   âœ… Cost predictable: $155/mo fixed (vs $500-5000 variable)
    %%   âœ… No limits: Unlimited time, unlimited data, unlimited queries
    %%   âœ… Vendor independence: Swap AI models anytime (Claude â†’ Grok â†’ Gemini)
    %%   âœ… Build competitive moat: Skills library + Knowledge graph (unreplicable)
    %% 
    %% V10 DUAL AI SYSTEMS:
    %%   1. "AI CÃ“ MÃY TÃNH" (Product AI - V7 Core):
    %%      - Purpose: AI lÃ m viá»‡c CHO USER
    %%      - Location: VPS3 Product AI (6GB RAM)
    %%      - Components: LangGraph Product, Skills Library (100+), MCPs, LobeChat
    %%      - Use cases: Research, content generation, data analysis, user-facing tasks
    %%      - Philosophy: Thay tháº¿ SaaS tools, tá»± chá»§ vá» data
    %% 
    %%   2. "AI OPERATIONS" (Agent AI - V10 New):
    %%      - Purpose: AI lÃ m viá»‡c CHO Há»† THá»NG
    %%      - Location: VPS3 Agent AI (3GB RAM)
    %%      - Components: 8 Autonomous Agents, LangGraph Agent, Agent databases, Alerta
    %%      - Use cases: Auto-deploy, auto-fix, cost monitoring, docs, security, optimization
    %%      - Philosophy: Autonomous operations, self-healing, 90% automation
    %% 
    %%   CRITICAL: HOÃ€N TOÃ€N TÃCH BIá»†T (ISOLATED):
    %%      - Separate LangGraph instances
    %%      - Separate databases (Neo4j, LanceDB, PostgreSQL, Redis)
    %%      - Separate Docker resource limits
    %%      - Different AI models (Product=Claude primary, Agent=Grok primary)
    %% 
    %% Analogy: "Cloud AI is renting an apartment. Own infrastructure is buying a house.
    %%           Both have uses, but one builds equity: Knowledge, Skills, Platform."
    %% 
    %% ============================================================================

    %% ============================================================================
    %% LAYER 0: OPERATIONS & IDENTITY - FOUNDERS LAYER
    %% ============================================================================
    
    subgraph LAYER0_OPERATIONS["ğŸ›ï¸ LAYER 0: OPERATIONS & IDENTITY - Founders & Devices"]
        direction TB
        
        %% Founders
        subgraph FOUNDERS_GROUP["ğŸ‘¥ FOUNDERS (2)"]
            direction LR
            
            FOUNDER1["ğŸ‘¤ FOUNDER 1<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ¯ Admin/CEO<br/>ğŸ“§ admin@rootknow.com<br/>ğŸ”‘ FULL Access (All VPS)<br/>ğŸ–¥ï¸ 4 Devices (2 laptops + 2 phones)<br/>ğŸŒ Hub: Notion + LobeChat"]
            
            FOUNDER2["ğŸ‘¤ FOUNDER 2<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ¯ Dev/Marketing<br/>ğŸ“§ dev@rootknow.com<br/>ğŸ”‘ LIMITED (VPS3 only)<br/>ğŸ–¥ï¸ 4 Devices (2 laptops + 2 phones)<br/>ğŸŒ Hub: LobeChat + Postiz"]
        end
        
        %% Google Workspace
        subgraph GOOGLE_WORKSPACE["ğŸ“§ GOOGLE WORKSPACE - SSOT for Identity"]
            direction LR
            
            ADMIN_ACCOUNT["ğŸ“§ admin@rootknow.com<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ¯ Primary Account<br/>ğŸ” Logto SSO + Zero Trust<br/>ğŸ“Š Gmail + Drive (100GB)<br/>ğŸ’° FREE"]
            
            DEV_ACCOUNT["ğŸ“§ dev@rootknow.com<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ¯ Secondary Account<br/>ğŸ” Logto SSO (Limited)<br/>ğŸ“Š Gmail + Drive (15GB)<br/>ğŸ’° FREE"]
        end
        
        %% Notion Databases (SSOT for Operations)
        subgraph NOTION_DATABASES["ğŸ“Š NOTION DATABASES - SSOT for Operations"]
            direction TB
            
            DB_ACCOUNTS["ğŸ’³ DATABASE 1: ACCOUNTS MASTER<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ¯ Centralized Credentials<br/>ğŸ“Š 100+ records (VPS, SaaS, APIs)<br/>ğŸ”„ Sync: Vaultwarden<br/>âš¡ Access: Founder 1 only"]
            
            DB_ACCESS["ğŸ” DATABASE 2: ACCESS CONTROL MATRIX<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ¯ Permissions Management<br/>ğŸ“Š 20+ users (Founders + Contractors)<br/>ğŸ”„ Trigger: Windmill â†’ Logto<br/>âš¡ Auto-provision"]
            
            DB_IP_ASSETS["ğŸ›ï¸ DATABASE 3: DATA & IP ASSETS<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ¯ IP & Data Governance<br/>ğŸ“Š 500+ assets (Code, Docs, Media)<br/>ğŸ“Š 4 levels: Public â†’ Secret<br/>âš¡ GDPR ready"]
        end
    end
    
    %% ============================================================================
    %% LAYER 7: ZERO TRUST SECURITY
    %% ============================================================================
    
    subgraph LAYER7_SECURITY["ğŸ”’ LAYER 7: ZERO TRUST & CLOUDFLARE"]
        direction TB
        
        CF_TUNNEL["â˜ï¸ CLOUDFLARE TUNNEL<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ¯ Secure Access Gateway<br/>ğŸ”§ Outbound-only + Auto SSL<br/>ğŸŒ 3 Tunnels (Coolify, Logto, Chat)<br/>ğŸ” Flow: User â†’ CF â†’ Logto â†’ VPS<br/>ğŸ’° FREE"]
        
        CF_ZERO_TRUST["ğŸ›¡ï¸ CLOUDFLARE ZERO TRUST<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ¯ Identity-based Access<br/>ğŸ”§ Device Posture + IP Whitelist<br/>ğŸ“Š 5 Policies (VPS1-3, Notion, Chat)<br/>ğŸ’° FREE (50 users)"]
        
        CF_WAF["ğŸ”¥ CLOUDFLARE WAF<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ¯ Web Application Firewall<br/>ğŸ”§ SQL/XSS/CSRF Protection<br/>ğŸ“Š OWASP + Custom Rules<br/>ğŸ’° FREE"]
    end

    %% ============================================================================
    %% SECTION 1: USER LAYER - ENTRY POINTS & INTERFACES
    %% ============================================================================
    
    subgraph USER_LAYER["ğŸ‘¥ USER LAYER - Entry Points & Interfaces"]
        direction TB
        
        %% Founder Node
        FOUNDER["ğŸ‘¤ FOUNDER (TRM CEO)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ¯ Admin Access | OAuth2 + 2FA"]
        
        %% User Interfaces Subgraph
        subgraph UI_INTERFACES["ğŸ’» USER INTERFACES"]
            direction LR
            
            NOTION["ğŸ“ NOTION<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ¢ Operations Hub<br/>ğŸ“Š 4 DBs | $10/mo"]
            
            LOBECHAT["ğŸ’¬ LOBECHAT<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ¤– AI Chat Interface<br/>2GB RAM | Port 3210 | FREE"]
        end
        
        %% API Gateway
        API_GATEWAY["ğŸšª API GATEWAY<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ” OAuth2 + Rate Limiting<br/>1GB RAM | Port 8080"]
    end

    %% ============================================================================
    %% SECTION 2: VPS2 - AI ORCHESTRATION LAYER
    %% ============================================================================

    subgraph VPS2_LAYER["ğŸ—„ï¸ VPS2: ALL DATABASES - Contabo 24GB RAM (194.233.84.112) - $15/mo â­ UPGRADED"]
        direction TB
        
        subgraph PRODUCT_DBS["ğŸ’¼ [VPS2] PRODUCT DATABASES (12GB)"]
            NEO4J_INTERNAL["ğŸ“Š NEO4J INTERNAL<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âš¡ 2M triples<br/>4GB RAM | Ports 7474,7687"]
            
            NEO4J_SUPERAPP["ğŸ“Š NEO4J SUPERAPP<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ¢ 19M triples â­ BIGGEST<br/>4GB RAM | Ports 7475,7688"]
            
            LANCEDB_PRODUCT["ğŸš€ LANCEDB PRODUCT<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ¯ 10M vectors (Embedded!)<br/>500MB RAM | Port 6333"]
            
            APP_POSTGRES["ğŸ—„ï¸ POSTGRESQL APP<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ’¾ App DB (Zep, NocoDB)<br/>2GB RAM | Port 5432"]
            
            REDIS_CLUSTER["âš¡ REDIS PRODUCT<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸš€ Cache + Queue + Pub/Sub<br/>1.5GB RAM | Port 6379"]
            
            NOCODB_APP["ğŸ“Š NOCODB<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ¯ Database UI<br/>1GB | Port 8080"]
        end
        
        subgraph AGENT_DBS["ğŸ¤– [VPS2] AGENT DATABASES (4.8GB) â­ V10"]
            NEO4J_AGENT["ğŸ“Š NEO4J AGENT<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ¤– 1M triples (Incident graph)<br/>2GB RAM | Ports 7476,7689"]
            
            LANCEDB_AGENT["ğŸš€ LANCEDB AGENT<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ¯ 400k vectors (Embedded!)<br/>300MB RAM | Port 6334"]
            
            AGENT_POSTGRES["ğŸ—„ï¸ POSTGRESQL AGENT<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ’¾ Agent state/logs<br/>1GB RAM | Port 5433"]
            
            REDIS_AGENT["âš¡ REDIS AGENT<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸš€ Agent queue<br/>1.5GB | Port 6380"]
        end
        
        subgraph LAKEHOUSE["ğŸ˜ï¸ LAKEHOUSE & ETL (2.2GB) â­ V10"]
            DUCKDB_APP["ğŸ¦† DUCKDB<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“Š Analytics Engine<br/>500MB RAM | Port 8080"]
            
            AIRBYTE_APP["âœˆï¸ AIRBYTE<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ”„ ETL Pipelines<br/>500MB RAM | Port 8000"]
            
            DBT_APP["ğŸ› ï¸ DBT<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“Š Data Transform<br/>200MB RAM | Port 8080"]
            
            UNSTRUCTURED_APP["ğŸ“„ UNSTRUCTURED.IO<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“ Document ETL<br/>500MB RAM | Port 8000"]
            
            ICEBERG_APP["â„ï¸ ICEBERG<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ—‚ï¸ Table Format<br/>500MB RAM"]
        end
        
        PROMTAIL_VPS2["ğŸ“¤ PROMTAIL<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“¨ Log Shipper<br/>200MB | Port 9080"]
    end

    %% ============================================================================
    %% SECTION 3: VPS1 - CONTROL PLANE
    %% ============================================================================

    subgraph VPS1_LAYER["ğŸ–¥ï¸ VPS1: CONTROL + MONITORING - Contabo 24GB RAM (46.250.237.194) - $15/mo"]
        direction TB
        
        subgraph INFRA_CORE["ğŸ­ï¸ [VPS1] INFRASTRUCTURE CORE (5.8GB)"]
            COOLIFY_APP["ğŸ³ COOLIFY<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ¯ PaaS Manager<br/>2GB RAM | Port 8000"]
            
            LOGTO_APP["ğŸ« LOGTO<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ” SSO/Identity<br/>1GB RAM | Ports 3001-3002"]
            
            VAULTWARDEN_APP["ğŸ” VAULTWARDEN<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ”‘ Secrets Manager<br/>500MB | Port 8200"]
            
            CORE_POSTGRES["ğŸ—„ï¸ CORE POSTGRESQL<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ’¾ Operational DB<br/>2GB RAM | Port 5432"]
            
            HEADSCALE_APP["ğŸŒ HEADSCALE<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ” VPN Mesh<br/>200MB | Port 8080"]
            
            KOPIA_APP["ğŸ’¾ KOPIA<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“¦ Backup Tool<br/>500MB | Port 51515"]
        end
        
        subgraph OBSERVABILITY["ğŸ“Š OBSERVABILITY STACK (8GB) â­ V10"]
            GRAFANA_APP["ğŸ“Š GRAFANA<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“ˆ Dashboards<br/>1GB RAM | Port 3000"]
            
            PROMETHEUS_APP["ğŸ“ˆ PROMETHEUS<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“Š Metrics (3 VPS)<br/>2GB RAM | Port 9090"]
            
            LOKI_APP["ğŸ“ LOKI<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“‹ Log Aggregation<br/>2GB RAM | Port 3100"]
            
            PROMTAIL_APP["ğŸ“¤ PROMTAIL<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“¨ Log Shipper<br/>200MB | Port 9080"]
            
            SENTRY_APP["ğŸ› SENTRY<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ” Error Tracking<br/>1GB RAM | Port 9000"]
            
            TEMPO_APP["ğŸ” TEMPO<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“¡ Distributed Tracing<br/>1GB RAM | Port 3200"]
            
            ALERTA_APP["ğŸš¨ ALERTA<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“¢ Alert Hub<br/>800MB | Port 8200"]
        end
        
        subgraph AUTOMATION["âš™ï¸ AUTOMATION (800MB) â­ V10"]
            WINDMILL_APP["ğŸŒªï¸ WINDMILL<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ Code-First Automation<br/>Python/TS/Go/Rust<br/>800MB RAM | Port 8000"]
        end
        
        subgraph REALTIME_DASHBOARD["ğŸ“Š REAL-TIME & DASHBOARD (1.3GB) â­ V10"]
            SUPABASE_REALTIME["âš¡ SUPABASE REALTIME<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ”Œ WebSocket Sync<br/>Broadcast + Presence<br/>500MB RAM | Port 4000"]
            
            REFLEX_DASHBOARD["ğŸŒ REFLEX DASHBOARD<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ Python Real-Time UI<br/>AI-Generated Dashboards<br/>800MB RAM | Port 3000"]
        end
        
        subgraph DEVOPS_SECURITY["ğŸ”§ DEVOPS & SECURITY (2.4GB) â­ V10"]
            GITEA_ACTIONS["ğŸ”„ GITEA ACTIONS<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸš€ CI/CD Pipeline<br/>1GB RAM | Port 3001"]
            
            TRIVY_APP["ğŸ›¡ï¸ TRIVY<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ”’ Security Scanner<br/>500MB | On-demand"]
            
            ZOT_REGISTRY["ğŸ“¦ ZOT REGISTRY<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ³ Docker Registry<br/>500MB | Port 5000"]
            
            WATCHTOWER_VPS1["ğŸ”„ WATCHTOWER<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ”„ Auto-updater<br/>200MB"]
            
            INFISICAL_APP["ğŸ” INFISICAL<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ¤– Secrets for Machines<br/>500MB | Port 8080"]
            
            FALCO_APP["ğŸš¨ FALCO<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ” Runtime Security<br/>300MB | Port 8765"]
            
            UPTIME_KUMA["ğŸŸ¢ UPTIME KUMA<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“Š Status Page<br/>200MB | Port 3001"]
        end
        
        subgraph MCP_GATEWAY["ğŸŒ MCP GATEWAY (1GB) â­ V10"]
            CONTEXTFORGE_APP["ğŸ”§ CONTEXTFORGE<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸŒ IBM MCP Gateway<br/>RESTâ†’MCP + gRPCâ†’MCP<br/>Multi-tenant + RBAC<br/>145+ MCP Tools<br/>1GB RAM | Port 8500"]
        end
    end

    %% ============================================================================
    %% SECTION 4: VPS3 - AI BRAIN + WORKLOAD
    %% ============================================================================

    subgraph VPS4_LAYER["ğŸ’» VPS4: CODE EXECUTION - Contabo 8GB RAM - $7-10/mo â­ NEW"]
        direction TB
        
        subgraph SKYPILOT_CLUSTER["ğŸš€ SKYPILOT CODE SANDBOX (8GB) - Self-Hosted, No Limits"]
            K3S["â˜¸ï¸ K3S KUBERNETES<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Lightweight K8s<br/>500MB RAM"]
            
            SKYPILOT_CONTROL["ğŸ› ï¸ SKYPILOT CONTROL<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Orchestrator<br/>500MB RAM | Port 8600"]
            
            subgraph CODE_EXEC_PODS["ğŸ”¥ CODE EXECUTION PODS (7GB) - Session Pooling"]
                POD_PYTHON["ğŸ Python Pod<br/>pandas, numpy, matplotlib<br/>Warm pool: 2 containers"]
                POD_JS["ğŸ“œ JavaScript Pod<br/>Node.js, npm packages<br/>Warm pool: 2 containers"]
                POD_MULTI["ğŸŒ Multi-Lang Pod<br/>Java, C++, Go, R<br/>On-demand"]
            end
            
            SKYPILOT_VOLUMES["ğŸ’¾ PERSISTENT VOLUMES<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Data survives restarts<br/>Session state preserved<br/>1GB storage"]
        end
        
        SKYPILOT_STATS["ğŸ“Š SKYPILOT STATS<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Performance: 300ms/exec<br/>7x faster than Modal<br/>$0 usage costs<br/>Unlimited sessions<br/>No quotas, no limits<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>MCP: Via ContextForge wrapper"]
    end
    
    subgraph VPS3_LAYER["ğŸ¤– VPS3: PRODUCT AI + AGENT AI - Contabo 12GB RAM (194.233.95.149) - $7.95/mo"]
        direction TB
        
        subgraph AI_MODELS["ğŸ§  AI MODELS (External API - NO RAM!)"]
            direction LR
            
            CLAUDE["ğŸ¯ CLAUDE 4.5<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>200K ctx | $3/$15<br/>Product: $15-40/mo<br/>Agent: $5-10/mo"]
            
            GROK["âš¡ GROK 4 FAST<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>2M ctx | $0.20/$0.50<br/>Product: $5-15/mo<br/>Agent: $5-15/mo â­ PRIMARY"]
            
            GEMINI["ğŸš€ GEMINI 2.0<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>1M ctx | $0.075/$0.30<br/>Product: $5-10/mo"]
        end
        
        subgraph PRODUCT_AI["ğŸ’¼ [VPS3] PRODUCT AI - 'AI CÃ“ MÃY TÃNH' (6GB)<br/>ğŸ¯ AI lÃ m viá»‡c CHO USER | Replace SaaS | Data Sovereignty"]
            LANGGRAPH_PRODUCT["ğŸ”„ LANGGRAPH PRODUCT<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ§  User AI Orchestration<br/>ğŸ”Œ MCP Client â†’ CF_CORE<br/>2GB RAM | Port 8001"]
            
            ZEP_PRODUCT["ğŸ§  ZEP PRODUCT<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ•°ï¸ User Memory<br/>2GB RAM | Port 8002"]
            
            LOBECHAT_APP["ğŸ’¬ LOBECHAT<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ¤– Chat Interface<br/>1GB RAM | Port 3210"]
            
            SKILLS_LIB["ğŸ“š SKILLS LIBRARY<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“ 100+ skills<br/>500MB"]
            
            WEBSOCKET["ğŸ”Œ WEBSOCKET<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âš¡ Realtime<br/>200MB | Port 8888"]
        end
        
        subgraph PRODUCT_APPS["ğŸ“¦ PRODUCT APPS (2GB)"]
            METAMCP_APP["ğŸš€ METAMCP<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“¦ Product App<br/>1GB RAM | Port 8003"]
            
            POSTIZ_APP["ğŸ“± POSTIZ<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“² Social Media<br/>500MB | Port 5000"]
        end
        
        subgraph AGENT_AI["ğŸ¤– [VPS3] AGENT AI - 'AI OPERATIONS' (3GB) â­ V10<br/>ğŸ¯ AI lÃ m viá»‡c CHO Há»† THá»NG | Self-healing 70% | 90% Automation"]
            LANGGRAPH_AGENT["ğŸ”„ LANGGRAPH AGENT<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ¤– Agent Orchestrator<br/>ğŸ”Œ MCP Client â†’ CF_CORE<br/>ğŸ› ï¸ Uses FastMCP framework<br/>1GB RAM | Port 8100"]
            
            ZEP_AGENT["ğŸ§  ZEP AGENT<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ•°ï¸ Agent Memory<br/>500MB | Port 8101"]
            
            subgraph EIGHT_AGENTS["8 AI AGENTS (1.5GB, 190MB each)"]
                AGENT_DEVOPS["ğŸ”§ DevOps<br/>190MB"]
                AGENT_DATA["ğŸ“Š Data<br/>190MB"]
                AGENT_ALERT["ğŸš¨ Alert<br/>190MB"]
                AGENT_FINANCE["ğŸ’° Finance<br/>190MB"]
                AGENT_DOC["ğŸ“ Doc<br/>190MB"]
                AGENT_COMPLIANCE["âš–ï¸ Compliance<br/>190MB"]
                AGENT_TEST["ğŸ§ª Test<br/>190MB"]
                AGENT_LEARNING["ğŸ“ Learning<br/>190MB"]
            end
        end
        
        AGENT_GRAFANA["ğŸ“Š AGENT GRAFANA<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“ˆ Agent Dashboard<br/>200MB | Port 3001"]
        
        PROMTAIL_VPS3["ğŸ“¤ PROMTAIL<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“¨ Log Shipper<br/>200MB | Port 9080"]
        
        WATCHTOWER_VPS3["ğŸ”„ WATCHTOWER<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ”„ Auto-updater<br/>200MB"]
    end
    
    %% ============================================================================
    %% SECTION 5: MCP GATEWAY LAYER - "AI Cáº¦M ÄÆ¯á»¢C Háº¾T INFRASTRUCTURE"
    %% ============================================================================
    
    subgraph MCP_GATEWAY_LAYER["ğŸŒ MCP GATEWAY LAYER - AI Control Infrastructure"]
        direction TB
        
        subgraph CONTEXTFORGE_GATEWAY["ğŸ”§ CONTEXTFORGE GATEWAY (VPS1, 1GB) - IBM Enterprise MCP Gateway"]
            direction TB
            
            CF_CORE["ğŸŒ CONTEXTFORGE CORE<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ” Auth: OAuth, JWT, SSO<br/>âš¡ Rate Limit: 100 req/min<br/>ğŸ”„ Federation: 3 VPS<br/>ğŸ“Š Observability: Phoenix, Jaeger<br/>1GB RAM | Port 8500"]
            
            subgraph CF_FEATURES["âœ¨ KILLER FEATURES"]
                CF_REST_MCP["ğŸ”„ REST â†’ MCP<br/>Auto-convert APIs to MCP tools<br/>No code needed!"]
                CF_GRPC_MCP["ğŸ”„ gRPC â†’ MCP<br/>Auto-reflection<br/>Service discovery"]
                CF_MULTI_TENANT["ğŸ‘¥ Multi-tenant<br/>Product AI vs Agent AI<br/>RBAC + Teams"]
                CF_OBSERVABILITY["ğŸ“Š Observability<br/>OpenTelemetry<br/>Phoenix + Jaeger"]
            end
        end
        
        CF_VIRTUAL_TOOLS["ğŸ¤– VIRTUAL MCP TOOLS<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>(Auto-generated inside CF_CORE)<br/><br/>ğŸš€ coolify-mcp: 20+ tools<br/>ğŸ”„ gitea-mcp: 15+ tools<br/>âš™ï¸ windmill-mcp: 10+ tools<br/>ğŸ“Š grafana-mcp: 10+ tools<br/>ğŸ“ˆ prometheus-mcp: 10+ tools<br/><br/>Total: 65+ virtual tools"]
        
        subgraph CUSTOM_MCP_SERVERS["ğŸ› ï¸ CUSTOM MCP SERVERS - Built with FastMCP"]
            direction LR
            
            CMCP_INFRA["ğŸ–¥ï¸ infrastructure-mcp<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>15+ tools<br/>Docker, System, Proxmox"]
            
            CMCP_DATABASE["ğŸ—„ï¸ database-mcp<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>20+ tools<br/>PostgreSQL, Neo4j, LanceDB"]
            
            CMCP_BACKUP["ğŸ’¾ backup-mcp<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>10+ tools<br/>Kopia, Snapshots, Restore"]
            
            CMCP_LAKEHOUSE["ğŸ  lakehouse-mcp<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>15+ tools<br/>DuckDB, dbt, Airbyte"]
        end
        
        subgraph EXTERNAL_MCP_SERVERS["â˜ï¸ EXTERNAL MCP SERVERS - 3rd Party"]
            direction LR
            
            EMCP_APIFY["ğŸ•·ï¸ Apify MCP<br/>Web scraping<br/>$10/mo"]
            
            EMCP_TWELVE["ğŸ¥ TwelveLabs MCP<br/>Video analysis<br/>$15/mo"]
            
            EMCP_PERPLEXITY["ğŸ” Perplexity MCP<br/>Search + Research<br/>$5/mo"]
            
            EMCP_REPLICATE["ğŸ¤– Replicate MCP<br/>AI models<br/>Pay-per-use"]
        end
        
        MCP_STATS["ğŸ“Š MCP COVERAGE<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Virtual MCPs: 65+ tools<br/>Custom MCPs: 60+ tools<br/>External MCPs: 20+ tools<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>TOTAL: 145+ MCP TOOLS<br/>AI control 95% infrastructure!"]
    end
    
    %% ============================================================================
    %% REALTIME SYNC & EVENT BUS
    %% ============================================================================
    
    subgraph EVENT_BUS["ğŸ”„ REALTIME SYNC & EVENT BUS"]
        direction TB
        
        subgraph REDIS_PUBSUB["ğŸ“¡ Redis Pub/Sub (VPS2)"]
            EVENTS_NOTION["ğŸ“ /events/notion/*<br/>Task updates, DB changes"]
            EVENTS_DB["ğŸ—„ï¸ /events/db/*<br/>PostgreSQL, Neo4j changes"]
            EVENTS_AI["ğŸ¤– /events/ai/*<br/>AI task results"]
        end
        
        CDC["ğŸ”„ CDC (Change Data Capture)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>PostgreSQL Logical Replication<br/>Neo4j CDC Plugin<br/>Latency: <100ms"]
    end

    %% ============================================================================
    %% BANKING & FINANCE LAYER
    %% ============================================================================
    
    subgraph BANKING_LAYER["ğŸ¦ BANKING & FINANCE"]
        direction TB
        
        subgraph US_BANKING["ğŸ‡ºğŸ‡¸ US Banking"]
            MERCURY["ğŸ’³ Mercury<br/>Primary checking<br/>ACH + Wire + Debit cards<br/>FDIC insured"]
            WISE_US["ğŸ’± Wise Business<br/>Multi-currency wallet<br/>50+ currencies<br/>Virtual cards"]
        end
        
        subgraph VN_BANKING["ğŸ‡»ğŸ‡³ VN Banking (Personal)"]
            VN_BANK["ğŸ¦ Vietcombank<br/>Personal VND account<br/>For local expenses"]
        end
        
        subgraph PAYMENT_GATEWAYS["ğŸ’³ Payment Gateways"]
            STRIPE["ğŸ’³ Stripe<br/>Primary processor<br/>Connected to Mercury<br/>2.9% + $0.30"]
            PAYPAL["ğŸ’³ PayPal Business<br/>Alternative payment<br/>Connected to Mercury<br/>2.99% + $0.49"]
            LEMONSQUEEZY["ğŸ‹ Lemon Squeezy<br/>Merchant of Record<br/>Handle VAT/taxes<br/>5% + $0.50"]
        end
        
        PRIVACY["ğŸ’³ Privacy.com<br/>Unlimited virtual cards<br/>For SaaS subscriptions<br/>â†’ Mercury<br/>FREE"]
    end
    
    %% ============================================================================
    %% 4 DATA FLOWS - AI AUTOMATION
    %% ============================================================================
    
    subgraph DATA_FLOWS["ğŸ”„ 4 DATA FLOWS - AI Automation"]
        direction TB
        
        FLOW_CHAT["1ï¸âƒ£ CHAT FLOW<br/>User â†’ LobeChat â†’ LangGraph<br/>â†’ Load Skills â†’ Route MCPs<br/>â†’ Execute â†’ Store â†’ Response"]
        
        FLOW_OPS["2ï¸âƒ£ Váº¬N HÃ€NH FLOW<br/>Notion update â†’ Windmill webhook<br/>â†’ LangGraph categorize<br/>â†’ Update DBs â†’ Post Slack<br/>â†’ AI learns patterns"]
        
        FLOW_AUTO["3ï¸âƒ£ Tá»° Äá»˜NG FLOW<br/>Windmill Cron (daily 6am)<br/>â†’ LangGraph research task<br/>â†’ Perplexity + Apify<br/>â†’ Generate report â†’ Notion<br/>â†’ Telegram alert"]
        
        FLOW_EVENT["4ï¸âƒ£ NGOáº I VI FLOW<br/>Webhooks (Stripe, GitHub)<br/>â†’ Windmill process<br/>â†’ LangGraph analyze<br/>â†’ Update KG â†’ Alert<br/>â†’ Auto-action if needed"]
    end

    %% ============================================================================
    %% EXTERNAL SERVICES
    %% ============================================================================
    
    subgraph EXTERNAL_SERVICES["â˜ï¸ EXTERNAL SERVICES"]
        direction LR
        
        MCP_APIFY["ğŸ•·ï¸ Apify<br/>$10/mo"]
        MCP_TWELVELABS["ğŸ¥ TwelveLabs<br/>$15/mo"]
        MCP_PERPLEXITY["ğŸ” Perplexity<br/>$5/mo"]
        MCP_REPLICATE["ğŸ¤– Replicate<br/>$3/mo"]
        R2_STORAGE["â˜ï¸ R2 Storage<br/>$16/mo"]
    end

    %% ============================================================================
    %% DATA STORAGE ARCHITECTURE & DATA LAKE
    %% ============================================================================
    
    subgraph DATA_STORAGE["ğŸ—„ï¸ DATA STORAGE ARCHITECTURE"]
        direction TB
        
        subgraph STRUCTURED_DATA["ğŸ“Š STRUCTURED DATA"]
            direction TB
            
            PG_STRUCTURE["ğŸ—„ï¸ POSTGRESQL STRUCTURE<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“ /var/lib/postgresql/14/<br/>â”œâ”€â”€ main/ (Core DB)<br/>â”œâ”€â”€ app/ (Application DB)<br/>â”œâ”€â”€ zep/ (Zep Memory)<br/>â””â”€â”€ nocodb/ (NocoDB)<br/><br/>Backup: pg_dump every 6h<br/>Retention: 14 days"]
            
            NEO4J_STRUCTURE["ğŸ“Š NEO4J STRUCTURE<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“ /var/lib/neo4j/<br/>â”œâ”€â”€ internal/ (2M triples)<br/>â”‚   â”œâ”€â”€ data/<br/>â”‚   â”œâ”€â”€ logs/<br/>â”‚   â””â”€â”€ plugins/<br/>â””â”€â”€ superapp/ (19M triples)<br/>    â”œâ”€â”€ data/<br/>    â”œâ”€â”€ logs/<br/>    â””â”€â”€ plugins/<br/><br/>Backup: neo4j-admin dump<br/>Retention: 14 days (internal)<br/>Retention: 4 weeks (superapp)"]
            
            LANCEDB_STRUCTURE["ğŸ” LANCEDB STRUCTURE<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“ /var/lib/lancedb/<br/>â”œâ”€â”€ datasets/<br/>â”‚   â”œâ”€â”€ embeddings/ (10M vectors)<br/>â”‚   â”œâ”€â”€ metadata/<br/>â”‚   â””â”€â”€ versions/<br/>â””â”€â”€ storage/<br/><br/>Backup: File-based daily<br/>Retention: 7 days"]
        end
        
        subgraph UNSTRUCTURED_DATA["ğŸ“ UNSTRUCTURED DATA"]
            direction TB
            
            R2_STRUCTURE["â˜ï¸ CLOUDFLARE R2 STRUCTURE<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“ trm-production-bucket/<br/>â”œâ”€â”€ backups/<br/>â”‚   â”œâ”€â”€ vps1/ (daily)<br/>â”‚   â”œâ”€â”€ vps2/ (daily)<br/>â”‚   â””â”€â”€ vps3/ (weekly)<br/>â”œâ”€â”€ uploads/<br/>â”‚   â”œâ”€â”€ images/<br/>â”‚   â”œâ”€â”€ documents/<br/>â”‚   â””â”€â”€ videos/<br/>â”œâ”€â”€ exports/<br/>â”‚   â”œâ”€â”€ notion/<br/>â”‚   â””â”€â”€ databases/<br/>â””â”€â”€ logs/<br/>    â”œâ”€â”€ application/<br/>    â””â”€â”€ system/<br/><br/>Lifecycle: 30 days â†’ Glacier<br/>Cost: $1.50/mo (100GB)"]
            
            GDRIVE_STRUCTURE["ğŸ“ GOOGLE DRIVE STRUCTURE<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“ RootKnow Shared Drive/<br/>â”œâ”€â”€ 01-Company/<br/>â”‚   â”œâ”€â”€ Legal/<br/>â”‚   â”œâ”€â”€ Finance/<br/>â”‚   â””â”€â”€ HR/<br/>â”œâ”€â”€ 02-Engineering/<br/>â”‚   â”œâ”€â”€ Architecture/<br/>â”‚   â”œâ”€â”€ Code/<br/>â”‚   â””â”€â”€ Docs/<br/>â”œâ”€â”€ 03-Operations/<br/>â”‚   â”œâ”€â”€ Backups/<br/>â”‚   â”œâ”€â”€ Runbooks/<br/>â”‚   â””â”€â”€ Incidents/<br/>â””â”€â”€ 04-Product/<br/>    â”œâ”€â”€ Designs/<br/>    â”œâ”€â”€ Research/<br/>    â””â”€â”€ Roadmap/<br/><br/>Sync: Real-time<br/>Cost: FREE (Business)"]
        end
        
        subgraph DATA_LAKE["ğŸŒŠ LAKEHOUSE ARCHITECTURE (R2)"]
            direction LR
            
            CDC_PIPELINE["ğŸ”„ CDC PIPELINE<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>PostgreSQL WAL<br/>â†’ pg_logical_replication<br/>â†’ Redis Streams<br/>â†’ LangGraph Consumer<br/><br/>Neo4j Changes<br/>â†’ neo4j-cdc-plugin<br/>â†’ Redis Streams<br/>â†’ LangGraph Consumer<br/><br/>Latency: <100ms<br/>Throughput: 1000+ events/min"]
            
            LAKEHOUSE["ğŸ  LAKEHOUSE (R2)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Tech Stack:<br/>â€¢ Storage: Cloudflare R2 (S3-compatible)<br/>â€¢ Format: Apache Parquet<br/>â€¢ Compression: Snappy<br/>â€¢ Query: DuckDB (embedded)<br/>â€¢ Catalog: Iceberg (metadata)<br/><br/>ğŸ“ trm-lakehouse/<br/>â”œâ”€â”€ bronze/ (raw CDC)<br/>â”œâ”€â”€ silver/ (cleaned)<br/>â””â”€â”€ gold/ (aggregated)<br/><br/>Retention: 90 days â†’ Archive"]
        end
        
        subgraph BACKUP_STRATEGY["ğŸ’¾ MULTI-TIER BACKUP STRATEGY"]
            direction TB
            
            TIER1["ğŸ”´ TIER 1: PRIMARY (R2)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Frequency: Every 4-6 hours<br/>Method: Automated (Windmill)<br/>Storage: Cloudflare R2<br/>Retention: 30 days<br/>Cost: $1.50/mo (100GB)<br/>Egress: FREE<br/><br/>Includes:<br/>â€¢ All VPS databases<br/>â€¢ Application configs<br/>â€¢ Vaultwarden vault<br/>â€¢ Windmill workflows"]
            
            TIER2["ğŸŸ¡ TIER 2: SECONDARY (GDrive)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Frequency: Daily (critical only)<br/>Method: Automated (Windmill)<br/>Storage: Google Drive<br/>Retention: 30 days<br/>Cost: FREE (Business)<br/><br/>Includes:<br/>â€¢ Vaultwarden (encrypted)<br/>â€¢ PostgreSQL (critical)<br/>â€¢ Neo4j Internal<br/>â€¢ Configs & secrets"]
            
            TIER3["ğŸŸ¢ TIER 3: COLD STORAGE (R2 Glacier)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Frequency: Weekly<br/>Method: Lifecycle policy<br/>Storage: R2 Glacier tier<br/>Retention: 1 year<br/>Cost: $0.50/mo (100GB)<br/><br/>Includes:<br/>â€¢ Monthly snapshots<br/>â€¢ Audit logs<br/>â€¢ Historical data<br/>â€¢ Compliance records"]
            
            TIER4["âšª TIER 4: EXTERNAL (GitHub)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Frequency: On change<br/>Method: Git auto-commit<br/>Storage: GitHub Private Repos<br/>Retention: Unlimited<br/>Cost: FREE<br/><br/>Includes:<br/>â€¢ Windmill workflows (code)<br/>â€¢ Skills Library (code)<br/>â€¢ Infrastructure configs<br/>â€¢ Documentation"]
        end
    end
    
    %% ============================================================================
    %% COMPLIANCE & CONTRACTOR MANAGEMENT
    %% ============================================================================
    
    subgraph COMPLIANCE_LAYER["âš–ï¸ COMPLIANCE & CONTRACTOR MANAGEMENT"]
        direction TB
        
        subgraph LEGAL_COMPLIANCE["âš–ï¸ LEGAL COMPLIANCE"]
            direction LR
            
            US_COMPANY["ğŸ›ï¸ US COMPANY<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Delaware C-Corp<br/>RootKnow Inc.<br/>EIN: Applied<br/>Registered Agent: Northwest<br/><br/>Annual: $500 (DE)<br/>Tax: $1,500-3,000 (CPA)"]
            
            GDPR_COMPLIANCE["ğŸŒ GDPR COMPLIANCE<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Privacy Policy: âœ…<br/>Cookie Consent: âœ…<br/>Data Export API: âœ…<br/>Data Delete API: âœ…<br/>DPA with vendors: âœ…<br/><br/>Tool: Termly ($10/mo)"]
            
            DATA_RESIDENCY["ğŸŒ DATA RESIDENCY<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Primary: Singapore (VPS)<br/>Backup: Global (R2)<br/>Compliance: PDPA (SG)<br/>EU Data: Separate region<br/><br/>Classification:<br/>â€¢ Public: R2 public<br/>â€¢ Internal: Notion<br/>â€¢ Confidential: PostgreSQL<br/>â€¢ Secret: Vaultwarden"]
        end
        
        subgraph CONTRACTOR_MGMT["ğŸ‘¥ CONTRACTOR MANAGEMENT"]
            direction LR
            
            ONBOARDING["ğŸš€ ONBOARDING (Windmill)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Trigger: Notion new row<br/>1. Create Logto account<br/>2. Provision access<br/>3. Send welcome email<br/>4. Create tasks<br/>5. Notify team<br/><br/>Duration: 8 min (automated)"]
            
            TIME_TRACKING["â±ï¸ TIME TRACKING<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Tool: Toggl Track<br/>Sync: Windmill â†’ Notion<br/>Frequency: Daily 11pm<br/>Alert: >40h/week<br/><br/>Database: Notion<br/>'Time Tracking'"]
            
            OFFBOARDING["ğŸš« OFFBOARDING (Windmill)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Trigger: Status = Offboarded<br/>1. Revoke all access (immediate)<br/>2. Archive data<br/>3. Calculate payment<br/>4. Send email<br/>5. Security audit<br/><br/>Duration: 16 min (90% auto)"]
        end
    end

    %% ============================================================================
    %% CONNECTIONS
    %% ============================================================================
    
    %% ============================================================================
    %% FOUNDER LAYER - "CHá»ˆ LÃI AI + XEM DASH" â­ CORE PHILOSOPHY
    %% ============================================================================
    
    %% Founder 1 â†’ Product AI (PRIMARY INTERFACE)
    FOUNDER1 -->|Chat| LOBECHAT_APP
    FOUNDER1 -->|Real-time| WEBSOCKET
    LOBECHAT_APP -->|AI Response| FOUNDER1
    WEBSOCKET -->|Push updates| FOUNDER1
    
    %% Founder 1 â†’ Dashboards (MONITORING ONLY)
    FOUNDER1 -->|View metrics| GRAFANA_APP
    FOUNDER1 -->|View status| REFLEX_DASHBOARD
    FOUNDER1 -->|View alerts| ALERTA_APP
    
    %% Founder 1 â†’ Emergency Access (RARE)
    FOUNDER1 -->|Emergency only| COOLIFY_APP
    FOUNDER1 -->|Data check| NOCODB_APP
    
    %% Founder 2 â†’ Agent AI (SECONDARY INTERFACE)
    FOUNDER2 -->|Monitor agents| AGENT_GRAFANA
    FOUNDER2 -->|View reports| REFLEX_DASHBOARD
    FOUNDER2 -->|Check status| UPTIME_KUMA
    
    %% Layer 0 â†’ Layer 7 (Security)
    FOUNDER1 --> CF_TUNNEL
    FOUNDER2 --> CF_TUNNEL
    CF_TUNNEL --> LOGTO_APP
    
    %% Layer 7 â†’ VPS1 (Auth)
    LOGTO_APP --> COOLIFY_APP
    LOGTO_APP --> WINDMILL_APP
    LOGTO_APP --> GRAFANA_APP
    
    %% VPS1 Infrastructure â†’ VPS2
    WINDMILL_APP --> APP_POSTGRES
    CORE_POSTGRES --> APP_POSTGRES
    
    %% VPS1 Observability â†’ All VPS
    PROMETHEUS_APP --> NEO4J_INTERNAL
    PROMETHEUS_APP --> NEO4J_SUPERAPP
    PROMETHEUS_APP --> LANCEDB_PRODUCT
    PROMETHEUS_APP --> NEO4J_AGENT
    PROMETHEUS_APP --> LANCEDB_AGENT
    GRAFANA_APP --> PROMETHEUS_APP
    LOKI_APP --> PROMTAIL_VPS2
    LOKI_APP --> PROMTAIL_VPS3
    ALERTA_APP --> PROMETHEUS_APP
    ALERTA_APP --> SENTRY_APP
    
    %% VPS1 DevOps â†’ VPS3
    COOLIFY_APP --> LOBECHAT_APP
    COOLIFY_APP --> METAMCP_APP
    COOLIFY_APP --> LANGGRAPH_PRODUCT
    COOLIFY_APP --> LANGGRAPH_AGENT
    GITEA_ACTIONS --> ZOT_REGISTRY
    GITEA_ACTIONS --> TRIVY_APP
    
    %% VPS1 â†’ VPS3 Automation
    WINDMILL_APP --> LANGGRAPH_PRODUCT
    WINDMILL_APP --> LANGGRAPH_AGENT
    

    %% VPS3 Product AI â†’ VPS4 CODE EXECUTION â­ "AI CÃ“ MÃY TÃNH RIÃŠNG"
    %% ============================================================================
    
    %% COMPLETE FLOW: Founder â†’ AI â†’ Code Execution â†’ Results
    
    %% Step 1: Founder requests code execution
    FOUNDER1 -->|"Analyze CSV with pandas"| LOBECHAT_APP
    LOBECHAT_APP -->|Parse request| LANGGRAPH_PRODUCT
    
    %% Step 2: LangGraph decides to execute code
    LANGGRAPH_PRODUCT -->|Route to SkyPilot| SKYPILOT_CONTROL
    LANGGRAPH_PRODUCT -.->|Execute Python| POD_PYTHON
    LANGGRAPH_PRODUCT -.->|Execute JS| POD_JS
    
    %% Step 3: Code execution in pods
    POD_PYTHON -->|Save results| SKYPILOT_VOLUMES
    POD_JS -->|Save results| SKYPILOT_VOLUMES
    SKYPILOT_VOLUMES -->|Load data| POD_PYTHON
    SKYPILOT_VOLUMES -->|Load data| POD_JS
    
    %% Step 4: Results back to founder
    POD_PYTHON -->|Results| LANGGRAPH_PRODUCT
    POD_JS -->|Results| LANGGRAPH_PRODUCT
    LANGGRAPH_PRODUCT -->|Format response| LOBECHAT_APP
    LOBECHAT_APP -->|Display| FOUNDER1
    WEBSOCKET -->|Push updates| FOUNDER1
    
    %% MCP Integration (Future)
    CF_CORE -.->|MCP wrapper (planned)| SKYPILOT_CONTROL
    
    %% VPS3 Product AI â†’ VPS2 Product DBs
    LANGGRAPH_PRODUCT --> NEO4J_INTERNAL
    LANGGRAPH_PRODUCT --> NEO4J_SUPERAPP
    LANGGRAPH_PRODUCT --> LANCEDB_PRODUCT
    LANGGRAPH_PRODUCT --> APP_POSTGRES
    LANGGRAPH_PRODUCT --> REDIS_CLUSTER
    ZEP_PRODUCT --> NEO4J_INTERNAL
    ZEP_PRODUCT --> LANCEDB_PRODUCT
    ZEP_PRODUCT --> APP_POSTGRES
    LOBECHAT_APP --> LANGGRAPH_PRODUCT
    LOBECHAT_APP --> WEBSOCKET
    
    %% VPS3 Agent AI â†’ VPS2 Agent DBs
    LANGGRAPH_AGENT --> NEO4J_AGENT
    LANGGRAPH_AGENT --> LANCEDB_AGENT
    LANGGRAPH_AGENT --> AGENT_POSTGRES
    LANGGRAPH_AGENT --> REDIS_AGENT
    ZEP_AGENT --> NEO4J_AGENT
    ZEP_AGENT --> LANCEDB_AGENT
    
    %% 8 Agents â†’ Orchestrator
    AGENT_DEVOPS --> LANGGRAPH_AGENT
    AGENT_DATA --> LANGGRAPH_AGENT
    AGENT_ALERT --> LANGGRAPH_AGENT
    AGENT_FINANCE --> LANGGRAPH_AGENT
    AGENT_DOC --> LANGGRAPH_AGENT
    AGENT_COMPLIANCE --> LANGGRAPH_AGENT
    AGENT_TEST --> LANGGRAPH_AGENT
    AGENT_LEARNING --> LANGGRAPH_AGENT
    
    %% Alert Agent â†’ Alerta
    AGENT_ALERT --> ALERTA_APP
    ALERTA_APP -.->|Read alerts| AGENT_ALERT
    
    %% DevOps Agent â†’ Infrastructure
    AGENT_DEVOPS --> COOLIFY_APP
    AGENT_DEVOPS --> HEADSCALE_APP
    
    %% Data Agent â†’ Databases
    AGENT_DATA --> NEO4J_INTERNAL
    AGENT_DATA --> NEO4J_SUPERAPP
    AGENT_DATA --> LANCEDB_PRODUCT
    
    %% Finance Agent â†’ Banking
    AGENT_FINANCE --> MERCURY
    AGENT_FINANCE --> STRIPE
    
    %% Banking connections
    STRIPE --> MERCURY
    PAYPAL --> MERCURY
    PRIVACY --> MERCURY
    WINDMILL_APP --> MERCURY
    WINDMILL_APP --> STRIPE
    
    %% User flows
    FOUNDER1 --> NOTION
    FOUNDER1 --> LOBECHAT_APP
    FOUNDER2 --> LOBECHAT_APP
    
    %% AI Models connections
    LANGGRAPH_PRODUCT --> CLAUDE
    LANGGRAPH_PRODUCT --> GROK
    LANGGRAPH_PRODUCT --> GEMINI
    LANGGRAPH_AGENT --> GROK
    LANGGRAPH_AGENT --> CLAUDE
    
    %% ============================================================================
    %% MCP GATEWAY CONNECTIONS - "AI Cáº¦M ÄÆ¯á»¢C Háº¾T"
    %% ============================================================================
    
    %% AI Systems â†’ ContextForge Gateway
    LANGGRAPH_PRODUCT --> CF_CORE
    LANGGRAPH_AGENT --> CF_CORE
    
    %% ContextForge â†’ Virtual MCPs (internal tools, auto-generated)
    %% Note: Virtual MCPs are internal to CF_CORE, not separate nodes
    %% They auto-convert REST APIs to MCP tools
    
    %% ContextForge â†’ Real Infrastructure (via internal virtual MCPs)
    CF_CORE -.->|coolify-mcp| COOLIFY_APP
    CF_CORE -.->|gitea-mcp| GITEA_ACTIONS
    CF_CORE -.->|windmill-mcp| WINDMILL_APP
    CF_CORE -.->|grafana-mcp| GRAFANA_APP
    CF_CORE -.->|prometheus-mcp| PROMETHEUS_APP
    
    %% ContextForge â†’ Custom MCPs
    CF_CORE --> CMCP_INFRA
    CF_CORE --> CMCP_DATABASE
    CF_CORE --> CMCP_BACKUP
    CF_CORE --> CMCP_LAKEHOUSE
    
    %% Custom MCPs â†’ Infrastructure (Direct SDK/API)
    CMCP_INFRA -.->|Docker SDK| COOLIFY_APP
    CMCP_DATABASE -.->|SQL| APP_POSTGRES
    CMCP_DATABASE -.->|Cypher| NEO4J_INTERNAL
    CMCP_DATABASE -.->|Arrow| LANCEDB_PRODUCT
    CMCP_BACKUP -.->|Kopia API| R2_LAKEHOUSE
    CMCP_LAKEHOUSE -.->|DuckDB| R2_LAKEHOUSE
    
    %% ContextForge â†’ External MCPs
    CF_CORE --> EMCP_APIFY
    CF_CORE --> EMCP_TWELVE
    CF_CORE --> EMCP_PERPLEXITY
    CF_CORE --> EMCP_REPLICATE
    
    %% ContextForge Observability
    CF_CORE -.->|Traces| TEMPO_APP
    CF_CORE -.->|Metrics| PROMETHEUS_APP
    CF_CORE -.->|Logs| LOKI_APP
    
    %% Skills Library connections
    LANGGRAPH_PRODUCT --> SKILLS_LIB
    SKILLS_LIB -.->|Provide workflows| LANGGRAPH_PRODUCT
    
    %% MCP Gateway connections
    LANGGRAPH_PRODUCT --> MCP_APIFY
    LANGGRAPH_PRODUCT --> MCP_TWELVELABS
    LANGGRAPH_PRODUCT --> MCP_PERPLEXITY
    LANGGRAPH_PRODUCT --> MCP_REPLICATE
    
    %% Notion Databases connections
    FOUNDER1 --> DB_ACCOUNTS
    FOUNDER1 --> DB_ACCESS
    FOUNDER1 --> DB_IP_ASSETS
    DB_ACCOUNTS -.->|Sync| VAULTWARDEN_APP
    DB_ACCESS -.->|Trigger| WINDMILL_APP
    WINDMILL_APP -.->|Provision| LOGTO_APP
    
    %% Realtime Event Bus
    NOTION -.->|Webhook| WINDMILL_APP
    WINDMILL_APP --> EVENTS_NOTION
    APP_POSTGRES -.->|CDC| CDC
    NEO4J_INTERNAL -.->|CDC| CDC
    CDC --> EVENTS_DB
    
    %% Event Consumers
    EVENTS_NOTION --> LANGGRAPH_PRODUCT
    EVENTS_DB --> LANGGRAPH_PRODUCT
    WEBSOCKET -.->|Push| LOBECHAT_APP
    
    %% Storage connections
    LANGGRAPH_PRODUCT --> R2_STORAGE
    LANGGRAPH_AGENT --> R2_STORAGE
    
    %% Data Storage connections
    APP_POSTGRES -.->|Structure| PG_STRUCTURE
    NEO4J_INTERNAL -.->|Structure| NEO4J_STRUCTURE
    NEO4J_SUPERAPP -.->|Structure| NEO4J_STRUCTURE
    LANCEDB_PRODUCT -.->|Structure| LANCEDB_STRUCTURE
    
    %% Backup flows - Multi-tier
    PG_STRUCTURE -->|Primary| TIER1
    NEO4J_STRUCTURE -->|Primary| TIER1
    LANCEDB_STRUCTURE -->|Primary| TIER1
    VAULTWARDEN_APP -->|Primary| TIER1
    
    TIER1 -->|Critical only| TIER2
    TIER1 -->|Weekly snapshot| TIER3
    WINDMILL_APP -->|Git commit| TIER4
    SKILLS_LIB -->|Git commit| TIER4
    
    %% CDC to Lakehouse
    CDC -->|Stream| CDC_PIPELINE
    CDC_PIPELINE -->|Bronze layer| LAKEHOUSE
    LAKEHOUSE -->|Archive| TIER3
    
    %% ============================================================================
    %% OLD TOOLS CONNECTIONS - FIX FAKE COMPONENTS!
    %% ============================================================================
    
    %% Coolify PaaS Manager (CRITICAL!)
    COOLIFY_APP -->|Deploy| LANGGRAPH_PRODUCT
    COOLIFY_APP -->|Deploy| LANGGRAPH_AGENT
    COOLIFY_APP -->|Deploy| LOBECHAT_APP
    COOLIFY_APP -->|Manage| NEO4J_INTERNAL
    COOLIFY_APP -->|Manage| LANCEDB_PRODUCT
    AGENT_DEVOPS -->|Control| COOLIFY_APP
    
    %% Logto SSO/Identity
    LOGTO_APP -->|Auth| LANGGRAPH_PRODUCT
    LOGTO_APP -->|Auth| LANGGRAPH_AGENT
    LOGTO_APP -->|Auth| GRAFANA_APP
    LOGTO_APP -->|Auth| NOCODB_APP
    
    %% Headscale VPN Mesh
    HEADSCALE_APP -->|Connect| VPS1_LAYER
    HEADSCALE_APP -->|Connect| VPS2_LAYER
    HEADSCALE_APP -->|Connect| VPS3_LAYER
    HEADSCALE_APP -->|Connect| VPS4_LAYER
    AGENT_DEVOPS -->|Configure| HEADSCALE_APP
    
    %% Grafana Dashboards
    GRAFANA_APP -->|Query| PROMETHEUS_APP
    GRAFANA_APP -->|Query| LOKI_APP
    GRAFANA_APP -->|Query| TEMPO_APP
    GRAFANA_APP -->|Display| ALERTA_APP
    AGENT_ALERT -->|Configure| GRAFANA_APP
    
    %% Sentry Error Tracking
    SENTRY_APP -->|Track errors| LANGGRAPH_PRODUCT
    SENTRY_APP -->|Track errors| LANGGRAPH_AGENT
    SENTRY_APP -->|Alert| ALERTA_APP
    AGENT_ALERT -->|Monitor| SENTRY_APP
    
    %% Tempo Distributed Tracing
    TEMPO_APP -->|Trace| LANGGRAPH_PRODUCT
    TEMPO_APP -->|Trace| LANGGRAPH_AGENT
    TEMPO_APP -->|Trace| CF_CORE
    GRAFANA_APP -->|Visualize| TEMPO_APP
    
    %% Gitea Actions CI/CD
    GITEA_ACTIONS -->|Build| LANGGRAPH_PRODUCT
    GITEA_ACTIONS -->|Build| LANGGRAPH_AGENT
    GITEA_ACTIONS -->|Push| ZOT_REGISTRY
    GITEA_ACTIONS -->|Scan| TRIVY_APP
    AGENT_DEVOPS -->|Trigger| GITEA_ACTIONS
    
    %% Trivy Security Scanner
    TRIVY_APP -->|Scan| ZOT_REGISTRY
    TRIVY_APP -->|Alert| ALERTA_APP
    AGENT_COMPLIANCE -->|Run| TRIVY_APP
    
    %% Zot Docker Registry
    ZOT_REGISTRY -->|Provide images| COOLIFY_APP
    GITEA_ACTIONS -->|Push| ZOT_REGISTRY
    
    %% NocoDB Database UI
    NOCODB_APP -->|Query| APP_POSTGRES
    NOCODB_APP -->|Display| NEO4J_INTERNAL
    AGENT_DATA -->|Manage| NOCODB_APP
    
    %% MetaMCP Product App
    METAMCP_APP -->|Use| CF_CORE
    METAMCP_APP -->|Query| NEO4J_SUPERAPP
    LANGGRAPH_PRODUCT -->|Integrate| METAMCP_APP
    
    %% Postiz Social Media
    POSTIZ_APP -->|Post| R2_STORAGE
    POSTIZ_APP -->|Schedule| WINDMILL_APP
    LANGGRAPH_PRODUCT -->|Generate content| POSTIZ_APP
    
    %% ============================================================================
    %% NEW TOOLS CONNECTIONS â­ V10 - MAKE THEM REAL!
    %% ============================================================================
    
    %% Kopia Backup Tool
    KOPIA_APP -->|Backup| PG_STRUCTURE
    KOPIA_APP -->|Backup| NEO4J_STRUCTURE
    KOPIA_APP -->|Backup| LANCEDB_STRUCTURE
    KOPIA_APP -->|Upload| TIER1
    WINDMILL_APP -->|Trigger| KOPIA_APP
    AGENT_DATA -->|Monitor| KOPIA_APP
    
    %% Infisical Secrets Management
    INFISICAL_APP -->|Provide secrets| LANGGRAPH_PRODUCT
    INFISICAL_APP -->|Provide secrets| LANGGRAPH_AGENT
    INFISICAL_APP -->|Provide secrets| WINDMILL_APP
    INFISICAL_APP -->|Provide secrets| COOLIFY_APP
    AGENT_DEVOPS -->|Manage| INFISICAL_APP
    
    %% Falco Runtime Security
    FALCO_APP -->|Monitor| COOLIFY_APP
    FALCO_APP -->|Alert| ALERTA_APP
    AGENT_COMPLIANCE -->|Configure| FALCO_APP
    PROMETHEUS_APP -->|Scrape| FALCO_APP
    
    %% Uptime Kuma Status Page
    UPTIME_KUMA -->|Monitor| COOLIFY_APP
    UPTIME_KUMA -->|Monitor| GRAFANA_APP
    UPTIME_KUMA -->|Monitor| LANGGRAPH_PRODUCT
    UPTIME_KUMA -->|Alert| ALERTA_APP
    AGENT_ALERT -->|Configure| UPTIME_KUMA
    
    %% Supabase Realtime Sync
    SUPABASE_REALTIME -->|Broadcast| WEBSOCKET
    SUPABASE_REALTIME -->|Sync| LANGGRAPH_PRODUCT
    SUPABASE_REALTIME -->|Sync| LANGGRAPH_AGENT
    REDIS_CLUSTER -->|Pub/Sub| SUPABASE_REALTIME
    
    %% Reflex Dashboard
    REFLEX_DASHBOARD -->|Query| PROMETHEUS_APP
    REFLEX_DASHBOARD -->|Query| APP_POSTGRES
    REFLEX_DASHBOARD -->|Display| SUPABASE_REALTIME
    LANGGRAPH_PRODUCT -->|Update| REFLEX_DASHBOARD
    LANGGRAPH_AGENT -->|Update| REFLEX_DASHBOARD
    
    %% Lakehouse Tools - DuckDB
    DUCKDB_APP -->|Query| LAKEHOUSE
    DUCKDB_APP -->|Export| R2_STORAGE
    LANGGRAPH_PRODUCT -->|Analyze| DUCKDB_APP
    AGENT_DATA -->|Monitor| DUCKDB_APP
    
    %% Lakehouse Tools - Airbyte
    AIRBYTE_APP -->|Extract| NEO4J_INTERNAL
    AIRBYTE_APP -->|Extract| APP_POSTGRES
    AIRBYTE_APP -->|Load| LAKEHOUSE
    AGENT_DATA -->|Configure| AIRBYTE_APP
    
    %% Lakehouse Tools - dbt
    DBT_APP -->|Transform| LAKEHOUSE
    DBT_APP -->|Test| LAKEHOUSE
    AGENT_DATA -->|Run| DBT_APP
    
    %% Lakehouse Tools - Unstructured.io
    UNSTRUCTURED_APP -->|Process| R2_STORAGE
    UNSTRUCTURED_APP -->|Extract| LAKEHOUSE
    LANGGRAPH_PRODUCT -->|Use| UNSTRUCTURED_APP
    
    %% Lakehouse Tools - Iceberg
    ICEBERG_APP -->|Catalog| LAKEHOUSE
    DUCKDB_APP -->|Query via| ICEBERG_APP
    
    %% Compliance connections
    WINDMILL_APP -.->|Automate| ONBOARDING
    WINDMILL_APP -.->|Automate| OFFBOARDING
    WINDMILL_APP -.->|Sync| TIME_TRACKING
    NOTION -.->|Trigger| ONBOARDING
    NOTION -.->|Trigger| OFFBOARDING

    %% ============================================================================
    %% STYLING
    %% ============================================================================
    
    classDef founderStyle fill:#E3F2FD,stroke:#1976D2,stroke-width:3px
    classDef securityStyle fill:#FFEBEE,stroke:#C62828,stroke-width:2px
    classDef vps1Style fill:#E8F5E9,stroke:#388E3C,stroke-width:2px
    classDef vps2Style fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    classDef vps3Style fill:#E1F5FE,stroke:#0277BD,stroke-width:2px
    classDef vps4Style fill:#F3E5F5,stroke:#6A1B9A,stroke-width:2px
    classDef bankingStyle fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    classDef externalStyle fill:#FFCCBC,stroke:#E64A19,stroke-width:2px
    
    class FOUNDER1,FOUNDER2 founderStyle
    class CF_TUNNEL,LOGTO_APP,VAULTWARDEN_APP,HEADSCALE_APP securityStyle
    class COOLIFY_APP,WINDMILL_APP,CORE_POSTGRES,GRAFANA_APP,PROMETHEUS_APP,LOKI_APP,PROMTAIL_APP,SENTRY_APP,TEMPO_APP,ALERTA_APP,GITEA_ACTIONS,TRIVY_APP,ZOT_REGISTRY,WATCHTOWER_VPS1,CONTEXTFORGE_APP,SUPABASE_REALTIME,REFLEX_DASHBOARD,INFISICAL_APP,FALCO_APP,UPTIME_KUMA,KOPIA_APP vps1Style
    class NEO4J_INTERNAL,NEO4J_SUPERAPP,LANCEDB_PRODUCT,APP_POSTGRES,REDIS_CLUSTER,NOCODB_APP,NEO4J_AGENT,LANCEDB_AGENT,AGENT_POSTGRES,REDIS_AGENT,PROMTAIL_VPS2,DUCKDB_APP,AIRBYTE_APP,DBT_APP,UNSTRUCTURED_APP,ICEBERG_APP vps2Style
    class LANGGRAPH_PRODUCT,ZEP_PRODUCT,LOBECHAT_APP,SKILLS_LIB,WEBSOCKET,METAMCP_APP,POSTIZ_APP,LANGGRAPH_AGENT,ZEP_AGENT,AGENT_DEVOPS,AGENT_DATA,AGENT_ALERT,AGENT_FINANCE,AGENT_DOC,AGENT_COMPLIANCE,AGENT_TEST,AGENT_LEARNING,AGENT_GRAFANA,PROMTAIL_VPS3,WATCHTOWER_VPS3 vps3Style
    class K3S,SKYPILOT_CONTROL,POD_PYTHON,POD_JS,POD_MULTI,SKYPILOT_VOLUMES,SKYPILOT_STATS vps4Style
    class MERCURY,WISE_US,STRIPE,PAYPAL,PRIVACY,VN_BANK,LEMONSQUEEZY bankingStyle
    class MCP_APIFY,MCP_TWELVELABS,MCP_PERPLEXITY,MCP_REPLICATE,R2_STORAGE,EMCP_APIFY,EMCP_TWELVE,EMCP_PERPLEXITY,EMCP_REPLICATE externalStyle
    class CLAUDE,GROK,GEMINI vps3Style
    class EVENTS_NOTION,EVENTS_DB,EVENTS_AI,CDC vps3Style
    
    %% Data Storage styling
    classDef dataStorageStyle fill:#E8EAF6,stroke:#3F51B5,stroke-width:2px
    classDef dataLakeStyle fill:#E0F2F1,stroke:#00897B,stroke-width:2px
    classDef backupStyle fill:#FFF3E0,stroke:#FF6F00,stroke-width:2px
    class PG_STRUCTURE,NEO4J_STRUCTURE,LANCEDB_STRUCTURE dataStorageStyle
    class R2_STRUCTURE,GDRIVE_STRUCTURE dataStorageStyle
    class CDC_PIPELINE,LAKEHOUSE dataLakeStyle
    class TIER1,TIER2,TIER3,TIER4 backupStyle
    
    %% Compliance styling
    classDef complianceStyle fill:#FFF9C4,stroke:#F9A825,stroke-width:2px
    classDef contractorStyle fill:#F3E5F5,stroke:#8E24AA,stroke-width:2px
    class US_COMPANY,GDPR_COMPLIANCE,DATA_RESIDENCY complianceStyle
    class ONBOARDING,TIME_TRACKING,OFFBOARDING contractorStyle
    
    %% ============================================================================
    %% ANNOTATIONS - COST BREAKDOWN & KEY METRICS
    %% ============================================================================
    
    %% Cost Summary V10
    COST_SUMMARY["ğŸ’° V10 ULTIMATE COST BREAKDOWN â­ 'AI CÃ“ MÃY TÃNH RIÃŠNG'<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ–¥ï¸ VPS Infrastructure: $45-48 â­ +VPS4<br/>  â€¢ VPS1 (24GB): $15.00 (Control + Monitoring)<br/>  â€¢ VPS2 (24GB): $15.00 â­ UPGRADED (All DBs + Lakehouse)<br/>  â€¢ VPS3 (12GB): $7.95 (Product + Agent AI)<br/>  â€¢ VPS4 (8GB): $7-10 â­ NEW (Code Execution - SkyPilot)<br/><br/>â˜ï¸ Storage & CDN: $20.00<br/>  â€¢ Cloudflare R2: $2.00 (Lakehouse + Backup)<br/>  â€¢ Google Drive: $0 (free)<br/>  â€¢ Backups: $18.00<br/><br/>ğŸ¤– AI Models (variable): $30-100 â­ SPLIT<br/>  â€¢ Product AI:<br/>    - Claude 4.5: $15-40<br/>    - Grok 4 Fast: $5-15<br/>    - Gemini 2.0: $5-10<br/>  â€¢ Agent AI:<br/>    - Grok 4 Fast: $5-15 (primary)<br/>    - Claude 4.5: $5-10 (complex only)<br/><br/>ğŸ”§ External MCPs: $33.00<br/>  â€¢ Apify: $10<br/>  â€¢ TwelveLabs: $15<br/>  â€¢ Perplexity: $5<br/>  â€¢ Replicate: $3<br/><br/>ğŸ“¦ SaaS Tools: $40.00<br/>  â€¢ Notion: $10<br/>  â€¢ QuickBooks: $30<br/><br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ’µ TOTAL: $138-141 (fixed) + $30-100 (variable)<br/>ğŸ“Š AVERAGE: ~$165/month (+$10 from V10)<br/>ğŸ¯ VALUE: +VPS4 Code Execution (300ms/exec, 7x faster than Modal)<br/>ğŸš€ BREAKTHROUGH: AI CÃ“ MÃY TÃNH RIÃŠNG - Cháº¡y code tháº­t, khÃ´ng giá»›i háº¡n!"]
    
    %% Key Metrics V10
    METRICS["ğŸ“Š V10 ULTIMATE METRICS & PERFORMANCE â­ 'AI CÃ“ MÃY TÃNH'<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ—„ï¸ Data Capacity: â­ EXPANDED<br/>  â€¢ Neo4j Product: 21M triples (2M + 19M)<br/>  â€¢ Neo4j Agent: 1M triples (incident graph)<br/>  â€¢ LanceDB Product: 10M vectors (embedded!)<br/>  â€¢ LanceDB Agent: 400k vectors (embedded!)<br/>  â€¢ PostgreSQL: 6 databases (4 product + 2 agent)<br/>  â€¢ Redis: 2 instances (product + agent)<br/><br/>âš¡ Performance:<br/>  â€¢ Realtime Sync: <200ms (was 5-15 min in V7)<br/>  â€¢ CDC Pipeline: <100ms latency<br/>  â€¢ DB Query: <50ms (p95)<br/>  â€¢ API Response: <500ms (p95)<br/>  â€¢ AI Task: <30s (p95)<br/>  â€¢ Code Execution: 300ms â­ NEW (7x faster than Modal)<br/><br/>ğŸ¤– Autonomous Operations: â­ V10<br/>  â€¢ 8 AI Agents: 90% automation<br/>  â€¢ Auto-deploy: <5 min<br/>  â€¢ Auto-fix: 70% incidents<br/>  â€¢ Alert response: <1 min<br/><br/>ğŸ’» Code Execution: â­ V10 ULTIMATE<br/>  â€¢ Languages: Python, JS, Java, C++, Go, R<br/>  â€¢ Session pooling: 2 warm containers (Python/JS)<br/>  â€¢ Unlimited executions: $0 usage cost<br/>  â€¢ Persistent volumes: 1GB storage<br/><br/>ğŸ¯ SLA Targets:<br/>  â€¢ Uptime: 99.9% (43 min/month)<br/>  â€¢ Error Rate: <0.1%<br/>  â€¢ Backup Success: 100%<br/>  â€¢ Agent Success Rate: >95%<br/>  â€¢ Code Exec Success: >98%"]
    
    %% 4 Data Flows
    FLOW_CHAT["ğŸ’¬ FLOW 1: CHAT (Real-time)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>User â†’ LobeChat â†’ WebSocket â†’ LangGraph<br/>â†’ AI Models (Claude/Grok/Gemini)<br/>â†’ Query DBs (Neo4j/LanceDB/PostgreSQL)<br/>â†’ Response â†’ WebSocket â†’ User<br/><br/>Latency: <200ms | Event-driven"]
    
    FLOW_OPS["âš™ï¸ FLOW 2: Váº¬N HÃ€NH (Automated)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Notion Update â†’ Webhook â†’ Windmill<br/>â†’ Redis Pub/Sub â†’ LangGraph<br/>â†’ Process Task â†’ Update Notion<br/>â†’ Slack Notification<br/><br/>Latency: <1s | Webhook-triggered"]
    
    FLOW_AUTO["ğŸ¤– FLOW 3: Tá»° Äá»˜NG (Scheduled)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Windmill Cron â†’ LangGraph â†’ AI Models<br/>â†’ Generate Content/Reports<br/>â†’ Update Databases<br/>â†’ Post to Social (Postiz)<br/><br/>Frequency: Hourly/Daily/Weekly"]
    
    FLOW_EXT["ğŸŒ FLOW 4: NGOáº I VI (External)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>LangGraph â†’ MCP Gateway (ContextForge)<br/>â†’ External MCPs (Apify/TwelveLabs/etc)<br/>â†’ Process Results â†’ Store in DBs<br/>â†’ Notify User<br/><br/>Latency: 5-30s | API-dependent"]
    
    FLOW_CODE["ğŸ’» FLOW 5: CODE EXECUTION â­ 'AI CÃ“ MÃY TÃNH RIÃŠNG'<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ‘¤ Founder: 'Analyze this CSV with pandas'<br/>â†“<br/>ğŸ’¬ LobeChat: Parse natural language request<br/>â†“<br/>ğŸ§  LangGraph: Understand â†’ Generate Python code<br/>â†“<br/>ğŸš€ SkyPilot Control: Route to warm Python pod<br/>â†“<br/>ğŸ Python Pod: Execute code (pandas, numpy, matplotlib)<br/>â†“<br/>ğŸ’¾ Persistent Volume: Save results + plots<br/>â†“<br/>ğŸ“Š Results: Return data + visualizations<br/>â†“<br/>ğŸ’¬ LobeChat: Display to founder<br/>âš¡ WebSocket: Push real-time updates<br/><br/>â±ï¸ Latency: 300ms | 7x faster Modal | $0 cost | Unlimited!<br/>ğŸ”¥ NO QUOTAS | NO LIMITS | PERSISTENT STATE"]
    
    %% Position annotations
    COST_SUMMARY -.->|Reference| VPS1_LAYER
    METRICS -.->|Reference| VPS2_LAYER
    FLOW_CHAT -.->|Reference| LOBECHAT_APP
    FLOW_OPS -.->|Reference| WINDMILL_APP
    FLOW_AUTO -.->|Reference| WINDMILL_APP
    FLOW_EXT -.->|Reference| CF_CORE
    FLOW_CODE -.->|Reference| VPS4_LAYER
    
    %% Style annotations
    classDef annotationStyle fill:#FFFDE7,stroke:#F57F17,stroke-width:2px,stroke-dasharray: 5 5
    class COST_SUMMARY,METRICS,FLOW_CHAT,FLOW_OPS,FLOW_AUTO,FLOW_EXT,FLOW_CODE annotationStyle
