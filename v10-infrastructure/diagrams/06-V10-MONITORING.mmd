%%{init: {
  'theme': 'base',
  'themeVariables': {
    'primaryColor': '#F3E5F5',
    'primaryTextColor': '#7B1FA2',
    'primaryBorderColor': '#8E24AA',
    'lineColor': '#424242',
    'secondaryColor': '#E8F5E9',
    'tertiaryColor': '#E1F5FE',
    'fontSize': '14px'
  }
}}%%

graph TB
    %% ============================================================================
    %% V10 OBSERVABILITY STACK - COMPLETE MONITORING
    %% ============================================================================
    %% Version: 10.0 ULTIMATE
    %% Focus: Full Observability with 7 Tools
    %% Date: 2025-11-04
    
    subgraph OBSERVABILITY["­ЪЊі OBSERVABILITY STACK (VPS1 - 8GB RAM)"]
        direction TB
        
        subgraph VISUALIZATION["­ЪЊі VISUALIZATION & DASHBOARDS"]
            GRAFANA["­ЪЊі GRAFANA<br/>РћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂ<br/>1GB RAM | Port 3000<br/><br/>Dashboards:<br/>Рђб System Overview<br/>Рђб Database Health<br/>Рђб AI Performance<br/>Рђб Agent Operations<br/>Рђб Cost Tracking<br/><br/>Data Sources:<br/>Рђб Prometheus<br/>Рђб Loki<br/>Рђб Tempo"]
        end
        
        subgraph METRICS["­ЪЊѕ METRICS COLLECTION"]
            PROMETHEUS["­ЪЊѕ PROMETHEUS<br/>РћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂ<br/>2GB RAM | Port 9090<br/><br/>Scrapes from:<br/>Рђб VPS1 (Control)<br/>Рђб VPS2 (Databases)<br/>Рђб VPS3 (AI Systems)<br/><br/>Metrics:<br/>Рђб CPU, Memory, Disk<br/>Рђб Container stats<br/>Рђб DB query latency<br/>Рђб AI task duration<br/>Рђб Agent success rate<br/><br/>Retention: 30 days"]
        end
        
        subgraph LOGS["­ЪЊЮ LOG AGGREGATION"]
            LOKI["­ЪЊЮ LOKI<br/>РћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂ<br/>2GB RAM | Port 3100<br/><br/>Aggregates logs from:<br/>Рђб All 3 VPS<br/>Рђб All containers<br/>Рђб System logs<br/>Рђб Application logs<br/><br/>Features:<br/>Рђб Label-based indexing<br/>Рђб LogQL queries<br/>Рђб Real-time streaming<br/><br/>Retention: 14 days"]
            
            PROMTAIL1["­ЪЊц PROMTAIL VPS1<br/>РћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂ<br/>200MB<br/><br/>Ships logs from:<br/>Рђб Coolify<br/>Рђб Windmill<br/>Рђб Observability stack<br/>Рђб DevOps tools"]
            
            PROMTAIL2["­ЪЊц PROMTAIL VPS2<br/>РћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂ<br/>200MB<br/><br/>Ships logs from:<br/>Рђб Neo4j (3 instances)<br/>Рђб Qdrant (2 instances)<br/>Рђб PostgreSQL (3 instances)<br/>Рђб Redis (2 instances)"]
            
            PROMTAIL3["­ЪЊц PROMTAIL VPS3<br/>РћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂ<br/>200MB<br/><br/>Ships logs from:<br/>Рђб LangGraph (2 instances)<br/>Рђб Zep (2 instances)<br/>Рђб 8 AI Agents<br/>Рђб Applications"]
        end
        
        subgraph ERRORS["­ЪљЏ ERROR TRACKING"]
            SENTRY["­ЪљЏ SENTRY<br/>РћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂ<br/>1GB RAM | Port 9000<br/><br/>Tracks errors from:<br/>Рђб Product AI<br/>Рђб Agent AI<br/>Рђб Applications<br/>Рђб APIs<br/><br/>Features:<br/>Рђб Stack traces<br/>Рђб Error grouping<br/>Рђб Impact analysis<br/>Рђб Slack integration<br/><br/>Retention: 90 days"]
        end
        
        subgraph TRACING["­ЪћЇ DISTRIBUTED TRACING"]
            TEMPO["­ЪћЇ TEMPO<br/>РћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂ<br/>1GB RAM | Port 3200<br/><br/>Traces:<br/>Рђб User requests<br/>Рђб AI task flows<br/>Рђб Agent operations<br/>Рђб Database queries<br/><br/>Features:<br/>Рђб OTLP protocol<br/>Рђб Span analysis<br/>Рђб Performance bottlenecks<br/><br/>Retention: 7 days"]
        end
        
        subgraph ALERTS["­Ъџе ALERT MANAGEMENT"]
            ALERTA["­Ъџе ALERTA<br/>РћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂ<br/>800MB | Port 8080<br/><br/>Aggregates alerts from:<br/>Рђб Prometheus<br/>Рђб Sentry<br/>Рђб Loki<br/>Рђб Custom sources<br/><br/>Features:<br/>Рђб Auto-triage<br/>Рђб Alert routing<br/>Рђб Escalation logic<br/>Рђб Incident tracking<br/><br/>Integration:<br/>Рђб Alert Agent (auto-fix)<br/>Рђб Slack notifications"]
        end
    end
    
    subgraph TARGETS["­Ъј» MONITORING TARGETS"]
        direction TB
        
        subgraph VPS1_TARGETS["­ЪќЦ№ИЈ VPS1 TARGETS"]
            VPS1_NODE["­ЪЊі Node Exporter<br/>System metrics"]
            VPS1_DOCKER["­Ъљ│ Docker Metrics<br/>Container stats"]
            VPS1_COOLIFY["­Ъџђ Coolify Metrics<br/>Deployment stats"]
        end
        
        subgraph VPS2_TARGETS["­ЪќЦ№ИЈ VPS2 TARGETS"]
            NEO4J_METRICS["­Ъћх Neo4j Metrics<br/>Query latency<br/>Connection pool<br/>Cache hit rate"]
            LANCEDB_METRICS["­Ъџђ LanceDB Metrics<br/>Search latency<br/>Vector count<br/>Memory usage"]
            PG_METRICS["­ЪЌё№ИЈ PostgreSQL Metrics<br/>Query performance<br/>Connections<br/>Replication lag"]
            REDIS_METRICS["­Ъћ┤ Redis Metrics<br/>Hit rate<br/>Memory usage<br/>Commands/sec"]
        end
        
        subgraph VPS3_TARGETS["­ЪќЦ№ИЈ VPS3 TARGETS"]
            LG_METRICS["­ЪДа LangGraph Metrics<br/>Task duration<br/>Success rate<br/>Token usage"]
            AGENT_METRICS["­Ъцќ Agent Metrics<br/>Agent uptime<br/>Auto-fix rate<br/>Response time"]
            APP_METRICS["­ЪЊ▒ App Metrics<br/>API latency<br/>Request rate<br/>Error rate"]
        end
    end
    
    subgraph DASHBOARDS["­ЪЊі GRAFANA DASHBOARDS"]
        direction LR
        
        DASH1["­ЪЊі SYSTEM OVERVIEW<br/>РћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂ<br/>Рђб CPU usage (3 VPS)<br/>Рђб Memory usage (3 VPS)<br/>Рђб Disk usage (3 VPS)<br/>Рђб Network I/O<br/>Рђб Container status<br/><br/>Alerts:<br/>Рђб CPU > 80% (5 min)<br/>Рђб Memory > 90% (5 min)<br/>Рђб Disk > 85%"]
        
        DASH2["­ЪЊі DATABASE HEALTH<br/>РћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂ<br/>Рђб Neo4j query latency<br/>Рђб Qdrant search latency<br/>Рђб PostgreSQL connections<br/>Рђб Redis hit rate<br/>Рђб Database sizes<br/><br/>Alerts:<br/>Рђб Query latency > 100ms<br/>Рђб Connections > 80%<br/>Рђб Hit rate < 90%"]
        
        DASH3["­ЪЊі AI PERFORMANCE<br/>РћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂ<br/>Рђб LangGraph task duration<br/>Рђб AI model API latency<br/>Рђб Token usage<br/>Рђб Agent success rate<br/>Рђб MCP call latency<br/><br/>Alerts:<br/>Рђб Task duration > 30s<br/>Рђб API latency > 5s<br/>Рђб Success rate < 95%"]
        
        DASH4["­ЪЊі AGENT OPERATIONS<br/>РћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂРћЂ<br/>Рђб Agent uptime (8 agents)<br/>Рђб Task success rate<br/>Рђб Response time<br/>Рђб Error rate<br/>Рђб Resource usage<br/><br/>Alerts:<br/>Рђб Agent down > 5 min<br/>Рђб Success rate < 90%<br/>Рђб Response time > 30s"]
    end
    
    %% Connections - Prometheus scraping
    PROMETHEUS --> VPS1_NODE
    PROMETHEUS --> VPS1_DOCKER
    PROMETHEUS --> VPS1_COOLIFY
    PROMETHEUS --> NEO4J_METRICS
    PROMETHEUS --> LANCEDB_METRICS
    PROMETHEUS --> PG_METRICS
    PROMETHEUS --> REDIS_METRICS
    PROMETHEUS --> LG_METRICS
    PROMETHEUS --> AGENT_METRICS
    PROMETHEUS --> APP_METRICS
    
    %% Connections - Loki aggregating
    LOKI --> PROMTAIL1
    LOKI --> PROMTAIL2
    LOKI --> PROMTAIL3
    
    %% Connections - Grafana data sources
    GRAFANA --> PROMETHEUS
    GRAFANA --> LOKI
    GRAFANA --> TEMPO
    
    %% Connections - Grafana dashboards
    GRAFANA --> DASH1
    GRAFANA --> DASH2
    GRAFANA --> DASH3
    GRAFANA --> DASH4
    
    %% Connections - Alerta aggregating
    ALERTA --> PROMETHEUS
    ALERTA --> SENTRY
    ALERTA --> LOKI
    
    %% Styling
    classDef visualizationStyle fill:#E1F5FE,stroke:#0277BD,stroke-width:3px
    classDef metricsStyle fill:#E8F5E9,stroke:#388E3C,stroke-width:2px
    classDef logsStyle fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    classDef errorsStyle fill:#FFEBEE,stroke:#C62828,stroke-width:2px
    classDef tracingStyle fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    classDef alertsStyle fill:#FFCCBC,stroke:#E64A19,stroke-width:2px
    classDef dashboardStyle fill:#E0F2F1,stroke:#00897B,stroke-width:2px
    
    class GRAFANA visualizationStyle
    class PROMETHEUS,VPS1_NODE,VPS1_DOCKER,VPS1_COOLIFY,NEO4J_METRICS,LANCEDB_METRICS,PG_METRICS,REDIS_METRICS,LG_METRICS,AGENT_METRICS,APP_METRICS metricsStyle
    class LOKI,PROMTAIL1,PROMTAIL2,PROMTAIL3 logsStyle
    class SENTRY errorsStyle
    class TEMPO tracingStyle
    class ALERTA alertsStyle
    class DASH1,DASH2,DASH3,DASH4 dashboardStyle
